/***	@filename	loxxolMap.js*	@author		loxxol*	@desc		loxmap, Automap with hotkeys and commands and useful info.loxxol'map 说明1.可用的热键：快速移动：见屏幕下方提示del--切换自动拾取backspace--回城F12--退出游戏F11--让其他人退出游戏X--一键开宝盒/合成，打开腰带则自动放药=--城外为开门，城内可吸引鼠标指向的npc[--使用前置技能]--显示地图信息和其他信息ctrl--自动清怪，以及自动杀6bossend--把装备输出到bot程序界面ins--暂停/继续mapbreak--停止/重开始map- --设置当前技能到主要攻击技能PgUp:说出"keyin",做任务用PgDown:说出"keyback",做任务用num0:说出"go.",成为队长num1-4,num6-7:说出对应数字,用于指挥小弟num5--强制所有人物到身边菜单键--显示/隐藏场景列表(-move用)==========================================2.指令：-@@紧跟函数名：所有人执行该函数-##紧跟函数名：自己执行该函数go.:说话者成为队长，可以使用队长指令-npc:所有人访问npc-bo:所有人使用前置技能-en:强化范围内所有人和随从，城内可用-len:强化范围内未强化的成员，城内可用-pick:所有人切换自动拾取-corp:所有人捡尸体-res:所有死亡者复活-s2:设置当前技能到次要攻击技能-rush:说话者自动带其他人完成rush-quest:说话者自动带其他人完成奖励任务next game:说话者建下一游戏，其他人加入-join 房间名/密码:全体加入某个游戏房间-ng:全体加入当前游戏名+1的房间-wp:说话者把本章的小站分享给其他人==========================================以下指令仅说话者执行：-clear:清除本地图所有怪-mark:记录当前人物所有装备，bot界面查看-skey:汇报人物身上三种钥匙数量-shop:开始对正在交易的npc进行shopbot(事先改好拾取:kolbot\pickit\shopbot.nip)-load 脚本名:运行bots里的脚本,注意大小写例如：-load Questing,完成全部奖励任务-move 场景代码:自动移动到该场景kkk:说话者成为跟班(做任务跑腿)-tp:关闭/打开 使用传送技能-dia:在diablo房间自动升级，并会跟随房间-baal:在baal房间自动升级，并会跟随房间-dropt:扔掉鼠标所持装备和同类型所有装备-dropc:扔掉鼠标所持装备和同名称所有装备-dropc 数量:扔掉指定数量鼠标所持装备和            同名称装备-drops:扔掉储物箱内全部装备-dropi:扔掉随身包内全部装备-dropa:扔掉随身包内全部装备,不含药水护符       以及回城书、鉴定书以及宝盒-dropg:扔掉储物箱和身上全部宝石-putin:将背包装备入箱,站在城内无需打开箱       子就可执行,药水护身符书卷不会入箱-take:写好装备列表takelist后召唤自动发货具体用法查阅:tools\autotake\readme.txt==========================================以下队长指令仅小弟们执行：1:进队长的传送门2:从队长的门回城3:取得最近的小站4:自己开门回城5:来队长身边6:贴身跟随队长并帮忙杀怪7:停止跟随队长8:尾随队长，但不出手9:去城内开门处a:强制小弟自动出手（跟随状态下)na:关掉小弟自动出手p:捡起地上有用装备pass:完成当前跨幕任务pass1,2,3,4:完成指定章节过关任务-come:来队长的地图，无小站则来同一幕*/const mapversion="(2017.7.18)";var autotakeprofile="autotake";const q_den=true;const q_raven=true;const q_cain=true;const q_hammer=true;const q_blade=true;const q_blackbook=true;const q_angel=true;const q_anya=true;const q_skillbook=true;const q_stone=false;include("json2.js");include("NTItemParser.dbl");include("OOG.js");include("AutoMule.js");include("Gambling.js");include("CraftingSystem.js");include("TorchSystem.js");include("MuleLogger.js");include("common/Attack.js");include("common/Cubing.js");include("common/CollMap.js");include("common/Config.js");include("common/Loader.js");include("common/Misc.js");include("common/Pickit.js");include("common/Pather.js");include("common/Precast.js");include("common/Prototypes.js");include("common/Runewords.js");include("common/Storage.js");include("common/Town.js");var Hooks = {	monsters: {		hooks: [],		enabled: true,		check: function () {			if (!this.enabled) {				this.flush();				return;			}			var i, unit;			for (i = 0; i < this.hooks.length; i += 1) {				if (!copyUnit(this.hooks[i].unit).x) {					this.hooks[i].hook[0].remove();					this.hooks[i].hook[1].remove();					this.hooks.splice(i, 1);					i -= 1;				}			}			unit = getUnit(1);			if (unit) {				do {					if (Attack.checkMonster(unit)) {						if (!this.getHook(unit)) {							this.add(unit);						} else {							this.updateCoords(unit);						}					} else {						this.remove(unit);					}				} while (unit.getNext());			}		},		newHook: function (unit) {			var arr = [];			arr.push(new Line(unit.x - 5, unit.y, unit.x + 5, unit.y, (unit.spectype & 0xF) ? 0x68 : 0x62, true));			arr.push(new Line(unit.x, unit.y - 5, unit.x, unit.y + 5, (unit.spectype & 0xF) ? 0x68 : 0x62, true));			return arr;		},		add: function (unit) {			this.hooks.push({				unit: copyUnit(unit),				hook: this.newHook(unit)			});		},		updateCoords: function (unit) {			var hook = this.getHook(unit);			if (!hook) {				return false;			}			hook[0].x = unit.x - 5;			hook[0].x2 = unit.x + 5;			hook[0].y = unit.y;			hook[0].y2 = unit.y;			hook[1].x = unit.x;			hook[1].x2 = unit.x;			hook[1].y = unit.y - 5;			hook[1].y2 = unit.y + 5;			return true;		},		getHook: function (unit) {			var i;			for (i = 0; i < this.hooks.length; i += 1) {				if (this.hooks[i].unit.gid === unit.gid) {					return this.hooks[i].hook;				}			}			return false;		},		remove: function (unit) {			var i;			for (i = 0; i < this.hooks.length; i += 1) {				if (this.hooks[i].unit.gid === unit.gid) {					this.hooks[i].hook[0].remove();					this.hooks[i].hook[1].remove();					this.hooks.splice(i, 1);					return true;				}			}			return false;		},		flush: function () {			while (this.hooks.length) {				this.hooks[0].hook[0].remove();				this.hooks[0].hook[1].remove();				this.hooks.shift();			}		}	},	text: {		hooks: [],		enabled: true,		check: function () {			if (!this.enabled) {				this.flush();				return;			}			if (!this.getHook("monsterStatus")) {				this.add("monsterStatus");			}			if (!this.getHook("vectorStatus")) {				this.add("vectorStatus");			}			if (!this.getHook("ping")) {				this.add("ping");			} else {				this.getHook("ping").hook.text = "Ping: " + me.ping;			}			if (!this.getHook("time")) {				this.add("time");			} else {				this.getHook("time").hook.text = this.timer();			}			if (!this.getHook("ip")) {				this.add("ip");			}		},		add: function (name) {			switch (name) {			case "ping":				this.hooks.push({					name: "ping",					hook: new Text("Ping: " + me.ping, 785, 56 + 16 * (Number(!!me.diff) + Number(!!me.gamepassword) + Number(!!me.gametype) + Number(!!me.gamename)), 4, 1, 1)				});				break;			case "time":				this.hooks.push({					name: "time",					hook: new Text(this.timer(), 785, 72 + 16 * (Number(!!me.diff) + Number(!!me.gamepassword) + Number(!!me.gametype) + Number(!!me.gamename)), 4, 1, 1)				});				break;			case "ip":				this.hooks.push({					name: "ip",					hook: new Text("IP: " + (me.gameserverip.length > 0 ? me.gameserverip.split(".")[3] : "0"), 785, 88 + 16 * (Number(!!me.diff) + Number(!!me.gamepassword) + Number(!!me.gametype) + Number(!!me.gamename)), 4, 1, 1)				});				break;			case "monsterStatus":				this.hooks.push({					name: "monsterStatus",					hook: new Text("Num *: "+getLocaleString(4213)+getLocaleString(4357), 525, 535)				});				break;			case "vectorStatus":				this.hooks.push({					name: "vectorStatus",					hook: new Text("Num -: "+getLocaleString(4213)+getLocaleString(2527), 525, 548)				});				break;			}		},		getHook: function (name) {			var i;			for (i = 0; i < this.hooks.length; i += 1) {				if (this.hooks[i].name === name) {					return this.hooks[i];				}			}			return false;		},		timer: function () {			var min, sec;			min = Math.floor((getTickCount() - me.gamestarttime) / 60000).toString();			if (min <= 9) {				min = "0" + min;			}			sec = (Math.floor((getTickCount() - me.gamestarttime) / 1000) % 60).toString();			if (sec <= 9) {				sec = "0" + sec;			}			return min + ":" + sec;		},		flush: function () {			if (getUIFlag(0x0D)) {				return;			}			while (this.hooks.length) {				this.hooks.shift().hook.remove();			}		}	},	vector: {		hooks: [],		currArea: 0,		enabled: true,		check: function () {			if (!this.enabled) {				this.flush();				return;			}			if (me.area !== this.currArea) {				this.flush();				var i, exits, wp, poi;				this.currArea = me.area;				exits = getArea().exits;				if (exits) {					for (i = 0; i < exits.length; i += 1) {						this.add(exits[i].x, exits[i].y, me.area === 46 && exits[i].target === getRoom().correcttomb ? 0x69 : 0x99);					}				}				wp = this.getWP();				if (wp) {					this.add(wp.x, wp.y, 0xA8);				}				poi = this.getPOI();				if (poi && !me.inTown) {					this.add(poi.x, poi.y, 0x7D);				}			} else {				this.update();			}		},		add: function (x, y, color) {			this.hooks.push(new Line(me.x, me.y, x, y, color, true));		},		update: function () {			var i;			for (i = 0; i < this.hooks.length; i += 1) {				this.hooks[i].x = me.x;				this.hooks[i].y = me.y;			}		},		flush: function () {			while (this.hooks.length) {				this.hooks.shift().remove();			}			this.currArea = 0;		},		getWP: function () {			if (Pather.wpAreas.indexOf(me.area) === -1) {				return false;			}			var i, preset,				wpIDs = [119, 145, 156, 157, 237, 238, 288, 323, 324, 398, 402, 429, 494, 496, 511, 539];			for (i = 0; i < wpIDs.length; i += 1) {				preset = getPresetUnit(me.area, 2, wpIDs[i]);				if (preset) {					return {						x: preset.roomx * 5 + preset.x,						y: preset.roomy * 5 + preset.y					};				}			}			return false;		},		getPOI: function () {			var unit, name;			switch (me.area) {			case 1: // 罗格营地			case 40: // 鲁高因			case 75: // 库拉斯特海港			case 103: // 群魔堡垒			case 109: // 哈洛加斯				unit = {					x: -1,					y: -1				};				name = getLocaleString(5008);				break;			case 3: // 冰冷之原				unit = getPresetUnit(me.area, 5, 3);				name = getLocaleString(5047);				break;			case 4: // Stony Field				unit = getPresetUnit(me.area, 1, 737);				name = getLocaleString(3230);				break;			case 5: // Dark Wood				unit = getPresetUnit(me.area, 2, 30);				name = getLocaleString(3240);				return {						x: unit.roomx * 5 + unit.x + 3,						y: unit.roomy * 5 + unit.y + 3,						name: name				};				break;			case 6: // 黑色荒地				unit = getPresetUnit(me.area, 5, 3);				name = getLocaleString(5045);				break;			case 8: // 邪恶洞窟				unit = getPresetUnit(me.area, 1, 774);				name = getLocaleString(3319);				break;			case 9: // 洞窟第一层				unit = getPresetUnit(me.area, 1, 736);				name = getLocaleString(2871);				break;			case 13: // 洞窟第二层			case 14: // 地底通道第二层			case 15: // 洞穴第二层			case 16: // 地穴第二层			case 18: // 墓地			case 19: // 大陵寝			case 59: // 石质古墓第二层			case 65: // 古代通道			case 84: // 蜘蛛巢穴			case 90: // 沼泽地洞第三层			case 116: // 漂泊者洞穴			case 119: // 冰窖			case 125: // 艾巴当			case 126: // 冥河之洞			case 127: // 地狱魔窟				unit = getPresetUnit(me.area, 2, 397);				name = getLocaleString(3290);				break;			case 25: // 高塔5层				unit = getPresetUnit(me.area, 2, 580);				name = getLocaleString(2875);				break;			case 28: // 军营				unit = getPresetUnit(me.area, 2, 108);				name = getLocaleString(2889);				break;			case 37: // 地下墓穴第四层				unit = {					x: 22532,					y: 9553				};				name = getLocaleString(3021);				break;			case 38: //崔斯特瑞姆				unit = {					x: 25048,					y: 5177				};				name = getLocaleString(2191);				break;			case 49: // Sewers 3				unit = getPresetUnit(me.area, 2, 355);				name = getLocaleString(2879);				break;			case 54: // 皇宫监牢第三层				unit = getPresetUnit(me.area, 2, 298);				name = getLocaleString(3308);				break;			case 60: // Halls of the Dead 3				unit = getPresetUnit(me.area, 2, 354);				name = getLocaleString(2231);				break;			case 61: //利爪蝮蛇神殿第二层				unit = {					x: 15045,					y: 14053				};				name = getLocaleString(22575);				break;			case 64: // Maggot Lair 3				unit = getPresetUnit(me.area, 1, 749);				name = getLocaleString(2884);				break;			case 66: // Tal Rasha's Tombs			case 67:			case 68:			case 69:			case 70:			case 71:			case 72:				unit = getPresetUnit(me.area, 2, 152) ? getPresetUnit(me.area, 2, 152) : getPresetUnit(me.area, 2, 397);				name = getPresetUnit(me.area, 2, 152) ? getLocaleString(825) : getLocaleString(3290);				break;			case 73: //都瑞尔的房间				unit = {					x: 22577,					y: 15593				};				name = getLocaleString(1013);				break;			case 74: // Arcane Sanctuary				unit = getPresetUnit(me.area, 2, 357);				name = getLocaleString(2887);				return {						x: unit.roomx * 5 + unit.x + 30,						y: unit.roomy * 5 + unit.y + 30,						name: name				};				break;			case 78: // Flayer Jungle				unit = getPresetUnit(me.area, 2, 252);				name = getLocaleString(2188);				break;			case 83: // 崔凡克				unit = {					x: getPresetUnit(83,2,237).roomx * 5 + getPresetUnit(83,2,237).x+70,					y: getPresetUnit(83,2,237).roomy * 5 + getPresetUnit(83,2,237).y-130				};				name = getLocaleString(5323);				break;			case 85: // 蜘蛛洞窟				unit = getPresetUnit(me.area, 2, 407);				name = getLocaleString(3290);				break;			case 91: // 剥皮地窖第三层				unit = getPresetUnit(me.area, 2, 406);				name = getLocaleString(3290);				break;			case 93: // 下水道第二层				unit = getPresetUnit(me.area, 2, 405);				name = getLocaleString(3290);				break;			case 94: // 残破神殿				unit = getPresetUnit(me.area, 2, 193);				name = getLocaleString(930);				break;			case 102: // Durance of Hate 3				unit = {					x: 17588,					y: 8069				};				name = getLocaleString(3062);				break;			case 105: // Plains of Despair				unit = getPresetUnit(me.area, 1, 256);				name = getLocaleString(1015);				break;			case 107: // River of Flame				unit = getPresetUnit(me.area, 2, 376);				name = getLocaleString(939);				break;			case 108: // Chaos Sanctuary				unit = getPresetUnit(me.area, 2, 255);				name = getLocaleString(2345);				break;			case 111: // Frigid Highlands			case 112: // Arreat Plateau			case 117: // Frozen Tundra				unit = getPresetUnit(me.area, 2, 60);				name = getLocaleString(3308);				break;			case 114: // 冰河				unit = getPresetUnit(me.area, 2, 460);				name = getLocaleString(21785);				break;			case 115: // 冰河路径				unit = getPresetUnit(me.area, 2, 455);				name = getLocaleString(3290);				break;			case 124: // Halls of Vaught				unit = getPresetUnit(me.area, 2, 462);				name = getLocaleString(22479);				break;			case 131: // 毁灭王座				unit = {					x: 15116,					y: 5068				};				name = getLocaleString(5323);				break;			case 132: // 世界之石大殿				unit = {					x: 15138,					y: 5916				};				name = getLocaleString(22643);				break;			case 133: // Matron's Den				unit = getPresetUnit(me.area, 2, 397);				name = getLocaleString(11154);				break;			case 135: // Furnace of Pain				unit = getPresetUnit(me.area, 2, 297);				name = getLocaleString(1014);				break;			}			if (unit) {				if (unit instanceof PresetUnit) {					return {						x: unit.roomx * 5 + unit.x,						y: unit.roomy * 5 + unit.y,						name: name					};				}				return {					x: unit.x,					y: unit.y,					name: name				};			}			return false;		}	},	tele: {		hooks: [],		action: null,		currArea: 0,		enabled: true,		prevAreas: [0, 0, 1, 2, 3, 10, 5, 6, 2, 3, 4, 6, 7, 9, 10, 11, 12, 3, 17, 17, 6, 20, 21, 22, 23, 24, 7, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,					36, 4, 1, 50, 40, 41, 42, 43, 44, 74, 40, 47, 48, 40, 50, 51, 52, 53, 41, 42, 56, 45, 55, 57, 58, 43, 62, 63, 44, 46, 46, 46, 46, 46,					46, 46, 1, 54, 1, 75, 76, 76, 78, 79, 80, 81, 82, 76, 76, 78, 86, 78, 88, 87, 89, 81, 92, 80, 80, 81, 81, 82, 82, 83, 100, 101, 102,					103, 104, 105, 106, 107, 103, 109, 110, 111, 112, 113, 113, 115, 115, 117, 118, 118, 109, 121, 122, 123, 111, 112, 117, 120, 128, 129,					130, 131, 109, 109, 109, 109],		event: function (keycode) {			Hooks.tele.action = keycode;		},		check: function () {			if (!this.enabled) {				return;			}			var hook,				obj = {					type: false,					dest: false				};			if (this.action) {				switch (this.action) {				case 190: // >					hook = this.getHook("Next Area");					obj.type = "area";					break;				case 188: // <					hook = this.getHook("Previous Area");					obj.type = "area";					break;				case 186: // ;					hook = this.getHook("Waypoint");					obj.type = "wp";					break;				case 191: // ?					hook = this.getHook("POI");					obj.type = "unit";					break;				case 222: // '					hook = this.getHook("Side Area");					obj.type = "area";					break;				}				if (hook) {					obj.dest = hook.destination;					try {							switch (obj.type) {							case "area":								Pather.moveToExit(obj.dest, true);								break;							case "unit":								if(me.area!=73)									Pather.moveToUnit(obj.dest, true);								break;							case "wp":								Pather.getWP(me.area);								break;							}						}					catch (e) {					}					//scriptBroadcast(JSON.stringify(obj));				}				this.action = null;			}			if (me.area !== this.currArea) {				this.flush();				this.add(me.area);				addEventListener("keyup", this.event);				this.currArea = me.area;			}		},		add: function (area) {			var i, exits, wp, poi, nextCheck,				nextAreas = [];			// Specific area override			nextAreas[7] = 26;			nextAreas[50] = 51;			nextAreas[76] = 78;			nextAreas[77] = 78;			nextAreas[113] = 115;			nextAreas[115] = 117;			nextAreas[118] = 120;			if (me.area === 46) {				nextAreas[46] = getRoom().correcttomb;			}			switch (me.area) {			case 2: // Blood Moor				this.hooks.push({					name: "Side Area",					destination: 8,					hook: new Text("': " + getAreaName(8), 150, 549 - (this.hooks.length * 13))				});				break;			case 3: // 冰冷之原				this.hooks.push({					name: "Side Area",					destination: 17,					hook: new Text("': " + getAreaName(17), 150, 549 - (this.hooks.length * 13))				});				break;			case 6: // Black Marsh				this.hooks.push({					name: "Side Area",					destination: 20,					hook: new Text("': " + getAreaName(20), 150, 549 - (this.hooks.length * 13))				});				break;			case 7: // 泰摩高地				this.hooks.push({					name: "Side Area",					destination: 12,					hook: new Text("': " + getAreaName(12), 150, 549 - (this.hooks.length * 13))				});				break;			case 10: // 地底通道第一层				this.hooks.push({					name: "Side Area",					destination: 14,					hook: new Text("': " + getAreaName(14), 150, 549 - (this.hooks.length * 13))				});				break;			case 17: // 埋骨之地				this.hooks.push({					name: "Side Area",					destination: 19,					hook: new Text("': " + getAreaName(19), 150, 549 - (this.hooks.length * 13))				});				break;			case 40: // 鲁高因				this.hooks.push({					name: "Side Area",					destination: 47,					hook: new Text("': " + getAreaName(47), 150, 549 - (this.hooks.length * 13))				});				break;			case 41: // 碎石荒地				this.hooks.push({					name: "Side Area",					destination: 55,					hook: new Text("': " + getAreaName(55), 150, 549 - (this.hooks.length * 13))				});				break;			case 42: // 干燥的高地				this.hooks.push({					name: "Side Area",					destination: 56,					hook: new Text("': " + getAreaName(56), 150, 549 - (this.hooks.length * 13))				});				break;			case 43: // Far Oasis				this.hooks.push({					name: "Side Area",					destination: 62,					hook: new Text("': " + getAreaName(62), 150, 549 - (this.hooks.length * 13))				});				break;			case 44: // 遗忘的城市				this.hooks.push({					name: "Side Area",					destination: 65,					hook: new Text("': " + getAreaName(65), 150, 549 - (this.hooks.length * 13))				});				break;			case 76:				this.hooks.push({					name: "Side Area",					destination: 85,					hook: new Text("': " + getAreaName(85), 150, 549 - (this.hooks.length * 13))				});				break;			case 78:				this.hooks.push({					name: "Side Area",					destination: 88,					hook: new Text("': " + getAreaName(88), 150, 549 - (this.hooks.length * 13))				});				break;			case 80:				this.hooks.push({					name: "Side Area",					destination: 94,					hook: new Text("': " + getAreaName(94), 150, 549 - (this.hooks.length * 13))				});				break;			case 81:				this.hooks.push({					name: "Side Area",					destination: 92,					hook: new Text("': " + getAreaName(92), 150, 549 - (this.hooks.length * 13))				});				break;			case 113:				this.hooks.push({					name: "Side Area",					destination: 114,					hook: new Text("': " + getAreaName(114), 150, 549 - (this.hooks.length * 13))				});				break;			case 115:				this.hooks.push({					name: "Side Area",					destination: 116,					hook: new Text("': " + getAreaName(116), 150, 549 - (this.hooks.length * 13))				});				break;			case 118:				this.hooks.push({					name: "Side Area",					destination: 119,					hook: new Text("': " + getAreaName(119), 150, 549 - (this.hooks.length * 13))				});				break;			}			poi = Hooks.vector.getPOI();			if (poi) {				this.hooks.push({					name: "POI",					destination: {x: poi.x, y: poi.y},					hook: new Text("?: " + poi.name, 150, 549 - (this.hooks.length * 13))				});			}			wp = Hooks.vector.getWP();			if (wp) {				this.hooks.push({					name: "Waypoint",					destination: {x: wp.x, y: wp.y},					hook: new Text(";: "+getLocaleString(22526), 150, 549 - (this.hooks.length * 13))				});			}			exits = getArea(area).exits;			if (exits) {				for (i = 0; i < exits.length; i += 1) {					if (exits[i].target === this.prevAreas[me.area]) {						this.hooks.push({							name: "Previous Area",							destination: this.prevAreas[me.area],							hook: new Text("<: " + getAreaName(this.prevAreas[me.area]), 150, 549 - (this.hooks.length * 13))						});						break;					}				}				// Check nextAreas first				for (i = 0; i < exits.length; i += 1) {					if (exits[i].target === nextAreas[me.area]) {						this.hooks.push({							name: "Next Area",							destination: nextAreas[me.area],							hook: new Text(">: " + getAreaName(nextAreas[me.area]), 150, 549 - (this.hooks.length * 13))						});						nextCheck = true;						break;					}				}				// In case the area isn't in nextAreas array, use this.prevAreas array				if (!nextCheck) {					for (i = 0; i < exits.length; i += 1) {						if (exits[i].target === this.prevAreas.indexOf(me.area)) {							this.hooks.push({								name: "Next Area",								destination: this.prevAreas.indexOf(me.area),								hook: new Text(">: " + getAreaName(this.prevAreas.indexOf(me.area)), 150, 549 - (this.hooks.length * 13))							});							break;						}					}				}			}		},		getHook: function (name) {			var i;			for (i = 0; i < this.hooks.length; i += 1) {				if (this.hooks[i].name === name) {					return this.hooks[i];				}			}			return false;		},		flush: function () {			while (this.hooks.length) {				this.hooks.shift().hook.remove();			}			removeEventListener("keyup", this.event);			this.currArea = 0;		}	},	update: function () {		while (!me.gameReady) {			delay(100);		}		this.monsters.check();		this.text.check();		this.vector.check();		this.tele.check();	},	flush: function () {		this.monsters.flush();		this.text.flush();		this.vector.flush();		this.tele.flush();		return true;	}};var drivername="noname";var keycharname="noname";var doormaker="noname";var leader;var leaderUnit;var hpnum="101%",mpnum="101%",expnum;var hpinfo,mpinfo,expinfo;var cursorItem;var autopick=false;var follow=0;//0-no,1-close,2-farvar followrange=20;var canfire=false;var wpmode=false;var rushmode=false;var questmode=false;var palacedoor=false;var keydooropen=false;var driverdooropen=false;var post=[];var mapinfoshow=false;var moveinfoshow=false;var charinfo=[];var charwindow=false;var keybusy=false;var driverbusy=false;var driverwait=false;var traover=false;var clearchaos=false;var coords = [];var questnum=1;var diablomode=false;var baalmode=false;var lastgamename;var lastgamepass;var lasttime;var lastdiff;var autocreate;var autojoin;var cgamename;var cgamepassword;var pausemap=false;var autotake=false;var mintakegametime;var checkitempick;var takeloc;var takerealm;var takegamename="";var takegamepass="";var dropend=false;var rinfo = new Array();var dropnum=1;var rname;var diabloleader;var diablodie=false;var stopbaal=false;function main() {	print("loxxol'Map Loaded");	var classes = ["Amazon", "Sorceress", "Necromancer", "Paladin", "Barbarian", "Druid", "Assassin"];	include("config/"+classes[me.classid]+".js");	LoadConfig();	Config.OpenChests = false;	Config.Dodge = false;	var mapinfo1=new Text("loxxol'map"+mapversion,487,16,4,0,3);	var mapinfo2=new Text("F9 show/hide help",320,16,4,0,1);	checkbelt();	Config.AttackSkill[0] = -1; // Preattack skill.	Config.AttackSkill[1] = 0; // Primary skill to bosses.	Config.AttackSkill[2] = 0; // Primary untimed skill to bosses. Keep at -1 if Config.AttackSkill[1] is untimed skill.	Config.AttackSkill[3] = 0; // Primary skill to others.	Config.AttackSkill[4] = 0; // Primary untimed skill to others. Keep at -1 if Config.AttackSkill[3] is untimed skill.	Config.AttackSkill[5] = -1; // Secondary skill if monster is immune to primary.	Config.AttackSkill[6] = -1; // Secondary untimed skill if monster is immune to primary untimed.	Config.HPBuffer = 20; // Number of healing potions to keep in inventory.	Config.MPBuffer = 10; // Number of mana potions to keep in inventory.	Config.RejuvBuffer = 40; // Number of rejuvenation potions to keep in inventory.	Config.LowManaSkill[0] = 0; // Low mana skill.	Config.LowManaSkill[1] = -1; // Low mana aura.	Config.LifeChicken = -1; // Exit game if life is less or equal to designated percent.	Config.ManaChicken = 0; // Exit game if mana is less or equal to designated percent.	Config.MercChicken = 0; // Exit game if merc's life is less or equal to designated percent.	Config.TownHP = 0; // Go to town if life is under designated percent.	Config.TownMP = 0; // Go to town if mana is under designated percent.	Config.PickitFiles.push("cube.nip");	cgamename=me.gamename;	cgamepassword=me.gamepassword;	readgameinfo();	if(autotake)doautotake();	while(autotake)delay(100000);	if(Math.abs(getTickCount()-lasttime)>120000){		diablomode=false;		baalmode=false;	}	savegameinfo(0);	readskill();	hpinfo=new Text("",71,550,2,1,1);	mpinfo=new Text("",732,550,2,1,1);	expnum=exppercent();	expinfo=new Text(exppercent(),335,553,0,4,1);	D2Bot.init();	Attack.init();	Pickit.init(true);	Storage.Init();	NPC = {	Akara: getLocaleString(2892),	Gheed: getLocaleString(2891),	Charsi: getLocaleString(2894),	Kashya: getLocaleString(2893),	Fara: getLocaleString(3025),	Drognan: getLocaleString(3023),	Elzix: getLocaleString(3030),	Greiz: getLocaleString(3031),	Lysander: getLocaleString(3026),	Ormus: getLocaleString(1011),	Alkor: getLocaleString(1010),	Hratli: getLocaleString(1009),	Asheara: getLocaleString(1008),	Jamella: getLocaleString(1016),	Halbu: getLocaleString(1017),	Tyrael: getLocaleString(1013),	Malah: getLocaleString(22478),	Anya: getLocaleString(22477),	Larzuk: getLocaleString(22476),	"Qual-Kehk": getLocaleString(22480),	Cain: getLocaleString(2890)	};	Town.initialize();	Town.tasks = [		{Heal: NPC.Akara, Shop: NPC.Akara, Gamble: NPC.Gheed, Repair: NPC.Charsi, Merc: NPC.Kashya, Key: NPC.Akara, CainID: NPC.Cain},		{Heal: NPC.Fara, Shop: NPC.Drognan, Gamble: NPC.Elzix, Repair: NPC.Fara, Merc: NPC.Greiz, Key: NPC.Lysander, CainID: NPC.Cain},		{Heal: NPC.Ormus, Shop: NPC.Ormus, Gamble: NPC.Alkor, Repair: NPC.Hratli, Merc: NPC.Asheara, Key: NPC.Hratli, CainID: NPC.Cain},		{Heal: NPC.Jamella, Shop: NPC.Jamella, Gamble: NPC.Jamella, Repair: NPC.Halbu, Merc: NPC.Tyrael, Key: NPC.Jamella, CainID: NPC.Cain},		{Heal: NPC.Malah, Shop: NPC.Malah, Gamble: NPC.Anya, Repair: NPC.Larzuk, Merc: NPC["Qual-Kehk"], Key: NPC.Malah, CainID: NPC.Cain}	];	Town.clearInventory = function(){};	this.revealArea = function (area) {		if (!this.revealedAreas) {			this.revealedAreas = [];		}		if (this.revealedAreas.indexOf(area) === -1) {			delay(500);			revealLevel(true);			this.revealedAreas.push(area);		}	};	this.keyEvent = function (key) {		switch (key) {		case 106: // Numpad *			if (Hooks.monsters.enabled) {				Hooks.monsters.enabled = false;				Hooks.text.getHook("monsterStatus").hook.text = "Num *: "+getLocaleString(4213)+getLocaleString(4357);			} else {				Hooks.monsters.enabled = true;				Hooks.text.getHook("monsterStatus").hook.text = "Num *: "+getLocaleString(4213)+getLocaleString(4357);			}			break;		case 109: // Numpad -			if (Hooks.vector.enabled) {				Hooks.vector.enabled = false;				Hooks.text.getHook("vectorStatus").hook.text = "Num -: "+getLocaleString(4213)+getLocaleString(2527);			} else {				Hooks.vector.enabled = true;				Hooks.text.getHook("vectorStatus").hook.text = "Num -: "+getLocaleString(4213)+getLocaleString(2527);			}			break;		case 46: // del			autopick=!autopick;			pri("autopick="+autopick);			//load("tools/test.js");			break;		case 220: // |			load("tools/test.js");			//Loader.getScripts();			//if(include("bots/BoneAsh.js"))say("1");			//Scripts.Andariel = true;			//global["Andariel"]();						break;		case 8: // backspace			Town.goToTown();			break;		case 123: // F12			savegameinfo(0);			delay(600);			scriptBroadcast("quit");			//quit();			break;		case 122: // F11			say('other quit');			break;		case 120: // F9			mapinfoshow=!mapinfoshow;			showhelp(mapinfoshow);			break;		case 93: // menulist			moveinfoshow=!moveinfoshow;			showmove(moveinfoshow);			break;		case 88: // x			if(getUIFlag(0x1A))				transmute();			else			if(getUIFlag(0x1F))				putpotion();			else				Cubing.openCube();			break;		case 187: // =			if(!me.inTown)				Pather.makePortal();			else{				//var cnpc;				//cnpc = getUnit(101);				//if(cnpc && cnpc.type==1)					if(_unit0 && _unit0.type==1)moveNPC(_unit0,me.x,me.y);			}			break;		case 219: // [			Precast.doPrecast(true);				break;		case 221: // ]			showareainfo();			break;		case 33: // pageup			say("keyin");				break;		case 34: // pagedown			say("keyback");				break;		case 191: // ？			if(me.inTown)				Town.move("portalspot");			else if(me.area==73){				Pather.moveTo(22630,15710);				Pather.moveTo(22611,15707);				Pather.walkTo(22607,15707);				Pather.moveTo(22580,15707);				Pather.moveTo(22579,15667);				Pather.moveTo(22579,15633);				Pather.moveTo(22577,15593);			}			break;		case 17: // ctrl			if(!me.inTown){				switch(me.area){				case 133:					if(me.getSkill(106, 1)>=20)						Config.AttackSkill[1] = 106;					else						Config.AttackSkill[1] = 97;					Config.AttackSkill[2] = 122;					Pather.moveToPreset(133, 2, 397, 2, 2);					Attack.kill(707);					//Attack.clear(5);					Pickit.pickItems();					Town.goToTown();					break;				case 134:					Config.AttackSkill[1] = 97;					Config.AttackSkill[2] = 122;					var	findLoc = [20196, 8694, 20308, 8588, 20187, 8639, 20100, 8550, 20103, 8688, 20144, 8709, 20263, 8811, 20247, 8665];					for (var i = 0; i < findLoc.length; i += 2) {						Pather.moveTo(findLoc[i], findLoc[i + 1]);						delay(500);											if (getUnit(1, 708)) {						break;						}					}					Attack.kill(708);					Pickit.pickItems();					Town.goToTown();					break;				case 135:					if(me.getSkill(106, 1)>=20)						Config.AttackSkill[1] = 106;					else						Config.AttackSkill[1] = 97;					Config.AttackSkill[2] = 122;					Pather.moveToPreset(135, 2, 397, 2, 2);					Attack.kill(706);					Pickit.pickItems();					Town.goToTown();					break;				case 136:					dotorch();					break;				default:					Attack.clear(25);						break;				}							}			break;		case 35: // end			Misc.spy(me.name);//看装备			break;		case 189: // -			setmyskill(true);			checkbelt();			break;		case 96: // 小键盘0			say("go.");			break;		case 97: // 小键盘1		case 98: // 小键盘2		case 99: // 小键盘3		case 100: // 小键盘4		case 102: // 小键盘6		case 103: // 小键盘7			say(key-96);			break;		case 101: // 小键盘5			say("-@@Pather.moveTo("+me.x+","+me.y+");");			break;		case 104: // 小键盘8			D2Bot.start("map8");			say("2");			break;		}	};		this.chatEvent = function (nick, msg) {		//特殊指令：		if(msg.substring(0,3)=="-@@"){					eval(msg.substring(3));		}		else if(msg.substring(0,3)=="-##" && nick==me.name){					eval(msg.substring(3));		}		else if(msg.substring(0,6)=="-join "){			cgamename=calclastgamename(msg.substring(6).split("/")[0]);			cgamepassword=msg.substring(6).split("/")[1];				savegameinfo(2);			delay(2000);			scriptBroadcast("quit");		}		else if(msg.substring(0,10)=="take this:"){			pickNear(10,1);		}				//全体指令		switch (msg) {		case "go.":		case "go":			drivername=nick;			leader = getParty(drivername);			leaderUnit = getLeaderUnit(drivername);			delay(500);			if(me.name!=drivername)				say("yes,"+leader.name);			break;		case "-npc":			Config.HPBuffer = 0;			Config.MPBuffer = 0;			Town.doChores();			Config.HPBuffer = 20;			Config.MPBuffer = 10;					break;		case "-bo":			Precast.doPrecast(true);				break;		case "-en":			if(me.getSkill(52,1) > 10)				autoChant();				break;		case "-len":			if(me.getSkill(52,1) > 10)				autoChant(true);				break;		case "-pick":			autopick=!autopick;			pri("autopick="+autopick);			break;		case "-corp":			Town.getCorpse();			break;		case "-res":			if (me.mode === 17)me.revive();			break;		case "-s2":			setmyskill(false);			break;		case "palace door open":			palacedoor=true;			break;		case "-quest":			questmode=true;			if(me.name==keycharname)				checkquest();			break;		case "other quit":			if(nick!=me.name)scriptBroadcast("quit");			break;		case "next game":			if(nick==me.name)				savegameinfo(1);			else{				savegameinfo(2);				delay(5000);			}			delay(800);			scriptBroadcast("quit");			break;		case "-ng":		case "-join":			savegameinfo(2);			delay(2000);			scriptBroadcast("quit");			break;		case "-wp":			if(nick==me.name)				givewp();			else				wpmode=true;			break;		}				//单人指令		if(nick==me.name){			if(msg.substring(0,5)=="-load"){				Config.HPBuffer = 0;				Config.MPBuffer = 0;				var order=msg.substring(6);				var orderline=FileTools.readText("libs/bots/"+order+".js");				eval(orderline+"\n"+order+"();");				Config.HPBuffer = 20;				Config.MPBuffer = 10;							}else			if(msg.substring(0,6)=="-move "){				try{Pather.journeyTo(parseInt(msg.substring(6)));}catch(e){}				
			}else			if(msg.substring(0,7)=="-dropc "){				try{					pausemap=true;					dropclass(parseInt(msg.substring(7)));					pausemap=false;				}catch(e){}							}						switch(msg){			case "-clear":				Attack.clearLevel();				break;			case "-mark":				pausemap=true;				MuleLogger.logChar(true,true,true);				pausemap=false;				break;				case "-skey":				say("tkey:"+checkcount(647));				say("hkey:"+checkcount(648));				say("dkey:"+checkcount(649));							break;				case "-shop":				if(checknpc())					ShopBot();				break;					break;				case "-rush":				rushmode=true;				prerush();				break;			case "kkk":				say("-@@keycharname = '"+me.name+"';");				delay(1000);				if(me.getItem(549))					say("box ok,rush ready");				else					say("need box");				break;			case "-tp":				Pather.teleport=!Pather.teleport;				pri("teleport = "+Pather.teleport);				break;			case "-dia":			case "-diablo":				dodiabloleech();				break;			case "-ndia":				diablodie=true;				break;			case "-nbaal":				stopbaal=true;				break;			case "-baal":			case "-baa":			case "-ball":				dobaalleech();				break;			case "-dropt":				droptype();				break;			case "-dropc":				pausemap=true;				dropclass();				pausemap=false;				break;			case "-drops":				pausemap=true;				dropstash();				pausemap=false;				break;			case "-dropi":				pausemap=true;				dropinv();				pausemap=false;				break;			case "-dropa":				pausemap=true;				dropall();				pausemap=false;				break;			case "-dropg":				pausemap=true;				dropallgem();				pausemap=false;				break;			case "-putin":				pausemap=true;				stashItems();				pausemap=false;				break;			case "-take":				writetake("tools/autotake/autotakegameinfo.txt",1);				delay(1000);				dealtakefile("tools/autotake/takelist.txt");				delay(2000);				D2Bot.start(autotakeprofile);				break;			}		}				//司机控制指令		if(me.name!=drivername && drivername==nick){			switch (msg) {			case "1":				if(me.inTown && leader){					Pather.usePortal(leader.area, drivername);					if(me.area==132 && rushmode && myrank()==2)say("bumber in 132");				}				break;			case "2":				if (me.mode === 17)me.revive();				if(!me.inTown){					Pather.usePortal(null, drivername);				}				follow=0;				break;			case "3":				if(Pather.getWP(me.area))					say("wp ok.");				if(wpmode)				{					switch(me.area)					{					case 35:						Pather.useWaypoint(1);						break;					case 46:						Pather.useWaypoint(40);						break;					case 101:						Pather.useWaypoint(75);						break;					case 107:						Pather.useWaypoint(103);						break;					case 129:						Pather.useWaypoint(109);						break;					default:						var townid=[0,1,40,75,103,109];						if(!Pather.usePortal(townid[me.act], drivername))							Town.goToTown();					}				}				break;			case "4":				Town.goToTown();				break;			case "5":				leaderUnit = getLeaderUnit(drivername);				if(leaderUnit && getDistance(me.x, me.y, leaderUnit.x, leaderUnit.y) <= 60)					Pather.moveToUnit(leaderUnit);				break;			case "6":				follow=1;				canfire=true;								break;			case "7":				follow=0;				break;			case "8":				follow=2;				break;			case "9":				if(me.inTown)					Town.move("portalspot");				break;			case "a":				canfire=true;				delay(400);				say("attack = "+canfire);				if(canfire)Attack.clear(20);				break;			case "na":				canfire=false;				delay(400);				say("attack = "+canfire);				break;			case "p":				if(me.name!=drivername && drivername==nick)					Pickit.pickItems();				break;			case "pass":				passact(me.act);				break;			case "pass1":				passact(1);				break;			case "pass2":				passact(2);				break;			case "pass3":				passact(3);				break;			case "pass4":				passact(4);				break;			case "-come":				var townid=[0,1,40,75,103,109];				try{					Town.move("waypoint");					Pather.useWaypoint(leader.area);				}catch (e) {					Pather.useWaypoint(townid[checkLeaderAct(leader)]);				}				break;			case "bb do den":				Town.move(NPC.Akara); 				target = getUnit(1, getLocaleString(2892));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				}				Town.move("portalspot");				if(me.name==keycharname)					checknextquest();				break;						}			//跟车指令			if(me.name==keycharname){				switch (msg) {				case "check rush":					if(me.getItem(549))						checkrush();					else						say("need box");					break;				case "keyin":					if(keybusy){						driverwait=true;						say("key busy");					}					else						dokeyin();					break;				case "keyback":					dokeyback();					break;				case "box":					if(Pickit.pickItem(getUnit(4, 549)))say("pick box ok");					if(Pickit.pickItem(getUnit(4, 518)))say("pick book ok");					Town.move("portalspot");					break;				case "check quest":					checkquest();					break;				case "check next quest":					checknextquest();					break;				case "key do blade":					Pickit.pickItem(getUnit(4, 87));					Town.move(NPC.Ormus);					var target = getUnit(1, getLocaleString(1011));					if (target && target.openMenu()) {						me.cancel();						say("bb do ormus");					}					Town.move( "portalspot" );					delay(6000);					checknextquest();						break;				}			}		}		//leader指令		if(me.name==drivername && rushmode){			switch (msg) {			case "need box":				if(me.area!=1)Pather.useWaypoint(1);				Town.move("stash");				Town.openStash();				gold(2000, 4);				gold(2000, 1);				Packet.dropItem(me.getItem(549));					Packet.dropItem(me.getItem(518));				say("box");				me.cancel();				Town.move(NPC.Akara); 				target = getUnit(1, getLocaleString(2892));				if (target && target.openMenu()) {					Town.initNPC("Shop").getItem("tbk").buy();					Town.initNPC("Shop").getItem(529).buy(true);					me.cancel();				}				say("check rush");				break;			case "city door open":				keydooropen=true;				dorush20();				break;			case "rush@1":				case "rush@2":				case "rush@3":				case "rush@4":				case "rush@5":				case "rush@6":				case "rush@7":				case "rush@8":				case "rush@9":					dorush(parseInt(msg.substring(msg.length-1)));			/*case "act1 over":				if(driverdooropen){					delay(500);					say("keyin");				}				break;*/			case "key in 37":				dorush11();				break;			case "key in 61":				dorush21();				break;			case "key in 64":				dorush31();				break;			case "key in 74":				dorush41();				break;			case "try tomb":				dorush51();				break;			case "key in 83":				dorush61();				break;			case "key in 102":				dorush71();				break;			case "key in 108":				dorush81();				break;			case "bumber in 132":				dorushbaal1();				break;			}		}				if(me.name==drivername && questmode){			switch (msg) {			case "quest@1":			case "quest@2":			case "quest@3":			case "quest@4":			case "quest@5":			case "quest@6":			case "quest@7":			case "quest@8":			case "quest@9":				doquest(parseInt(msg.substring(msg.length-1)));				break;			case "cain scroll ready":				say("keyin");				break;			}		}								//仅bb的指令		if(me.name!=drivername && me.name!=keycharname){			var target;			switch (msg){			case "bb do cain":				Town.move(NPC.Akara); 				target = getUnit(1, getLocaleString(2892));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				}				Town.move("portalspot");				break;			case "bb do ormus":				Town.move(NPC.Ormus); 				target = getUnit(1, getLocaleString(1011));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				}				Town.move("portalspot");				break;			case "bb do act1":				passact(1);				break;			case "keychar ready":				delay(10000);			case "bb do act2":				passact(2);				break;			case "bb do act3":				passact(3);				break;			case "bb do act4":				passact(4);				break;			case "bb do raven":				Town.move(NPC.Kashya); 				target = getUnit(1, getLocaleString(2893));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				}				Town.move("portalspot");				break;			case "bb do anya":				Town.move(NPC.Malah); 				target = getUnit(1, getLocaleString(22478));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				}				Town.move("portalspot");				useItem(646);				break;			case "bb do skillbook":				Town.move("portalspot");				Pather.usePortal(49, drivername);				delay(500);				while (true) {					target = getUnit(4, 552);        					if (!target)break;					Pickit.pickItem(target);					delay(250);					if (me.getItem(552))break;				} 				Pather.usePortal(40, drivername); 				Town.move("atma"); 				target = getUnit(1, getLocaleString(3024));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				}				Town.move("portalspot");				useItem(552);				break;			case "bb do talkcain":				Town.move("cain"); 				target = getUnit(1, getLocaleString(2890));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				}				Town.move("portalspot");				break;			case "bb do angel":				Town.move(NPC.Tyrael); 				target = getUnit(1, getLocaleString(1013));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				}				Town.move("portalspot");				break;			case "move amu to box ok":				if(me.name==doormaker && me.getItem(518)){					Pather.moveToExit(50, true);					if(Pather.makePortal())say("palace door open");					Pather.moveToExit(40, true);				}				break;			case "bb goto act1":			case "bb goto act2":			case "bb goto act3":			case "bb goto act4":			case "bb goto act5":				Town.move("waypoint");				if(Pather.useWaypoint([0,1,40,75,103,109][parseInt(msg.substring(msg.length-1))]))					Town.move("portalspot");				break;			case "box":				if(me.area==75){					Pather.usePortal(83, drivername);					while (true) {						target = getUnit(4, 549);						if (!target)break;						Pickit.pickItem(target);						delay(250);						if (me.getItem(549)){							say("pick box ok");							break;						}					}					Pather.usePortal(75, drivername);					Town.move("cain"); 					target = getUnit(1, getLocaleString(2890));					if (target && target.openMenu()) {						me.cancel();						say("talked "+target.classid);					}					Town.move("portalspot");									}else				if(me.area==1 && me.name==doormaker){					target = getUnit(4, 523);					if (target)	Pickit.pickItem(target);					delay(250);					Town.move(NPC.Akara); 					target = getUnit(1, getLocaleString(2892));					if (target && target.openMenu()) {						Town.initNPC("Shop").getItem("tbk").buy();						Town.initNPC("Shop").getItem(529).buy(true);						me.cancel();					}					Town.move("stash");				}			}		}	};	var i,		hideFlags = [0x09, 0x0C, 0x0D, 0x01, 0x02, 0x0F, 0x18, 0x19, 0x21];	addEventListener("keyup", this.keyEvent);	addEventListener("chatmsg", this.chatEvent);	Packet.changeStat(105, 255);	Packet.changeStat(99, 255);	Packet.changeStat(102, 255);	Packet.changeStat(93, 255);	Config.PacketCasting = 1;	var maptimer=0;	var _info = new UnitInfo();	var _unit0;	var __script;	__script = getScript("tools/ToolsThread.js");			if(__script && __script.running){		__script.stop();	}		if(diablomode)		dodiabloleech();	if(baalmode)		dobaalleech();	while (true) {		maptimer++;		if(maptimer==1800)		{			maptimer=0;			if(me.area!=0)say("! ");		}		if(fullbelt())checkbelt();		while (!me.area || !me.gameReady || pausemap) {			delay(100);		}		this.revealArea(me.area);		if (getUIFlag(0x0A)) {			Hooks.update();		} else {			Hooks.flush();		}		if(charwindow!=getUIFlag(0x02)){			charwindow=getUIFlag(0x02);			showcharinfo(getUIFlag(0x02));		}					showinfo();		if(follow==1)			followleader();		if(follow==2)			farfollowleader();				if(autopick)Pickit.pickItems();		if(follow>0 && me.hp/me.hpmax<0.25 && me.area!=0)		{			Town.goToTown();			follow=0;		}		_unit0 = getUnit(101);		_info.createInfo(_unit0);		delay(200);		for (i = 0; i < hideFlags.length; i += 1) {			while(me.gameReady && getUIFlag(hideFlags[i])) {				Hooks.flush();				if(getUIFlag(0x02)){					charwindow=getUIFlag(0x02);					showcharinfo(getUIFlag(0x02));				}				delay(100);			}		}	}}function getLeaderUnit(name) {	var player = getUnit(0, name);		if (player) {		do {			if (!player.dead) {				return player;			}		} while (player.getNext());	}	return false;}function pri(txt,color,x,y,font,alignment)//；倒数第二位：字体，大约10几种；最后一位：1-字符右下角坐标,2-字符中间坐标，3-字符左下角坐标{	if( arguments.length < 6 )		alignment=3;	if( arguments.length < 5 )		font=1;	if( arguments.length < 3 ){		x=80;		y=120;    }	if( arguments.length < 2 )		color=0;		var _text=new Text(txt,x,y,color,font,alignment);	delay(5000);	_text.remove();	}function showinfo(){	var hpnow=(me.hp/me.hpmax*100).toFixed(0)+"%";	var mpnow=(me.mp/me.mpmax*100).toFixed(0)+"%";	var expnow=exppercent();	if(hpnum!=hpnow)	{			hpnum=hpnow;			hpinfo.remove();			hpinfo=new Text(hpnum,71,550,2,1,1);	}	if(mpnum!=mpnow)	{			mpnum=mpnow;			mpinfo.remove();			mpinfo=new Text(mpnum,732,550,2,1,1);	}	if(expnum!=expnow)	{			expnum=expnow;			expinfo.remove();			expinfo=new Text(expnum,335,547,0,4,1);	}	var cursorItem=getUnit(100);	if(cursorItem){		var iteminfo1=new Text(report(cursorItem),62,480,18,4,3);		var iteminfo2=new Text(reportstat(cursorItem),422,500,18,4,3);		delay(3000);		iteminfo1.remove();		iteminfo2.remove();	}			}function exppercent(){	var _exp;	var _mylevel;	var _exphead;	var expnext;	_exp=me.getStat(13);var _TotalExp = [0, 0, 500, 1500, 3750, 7875, 14175, 22680, 32886, 44396, 57715, 72144, 90180, 112725, 140906, 176132, 220165, 275207, 344008, 430010, 537513, 671891, 839864, 1049830, 1312287, 1640359, 2050449, 2563061, 3203826, 3902260, 4663553, 5493363, 6397855, 7383752, 8458379, 9629723, 10906488, 12298162, 13815086, 15468534, 17270791, 19235252, 21376515, 23710491, 26254525, 29027522, 32050088, 35344686, 38935798, 42850109, 47116709, 51767302, 56836449, 62361819, 68384473, 74949165, 82104680, 89904191, 98405658, 107672256, 117772849, 128782495, 140783010, 153863570, 168121381, 183662396, 200602101, 219066380, 239192444, 261129853, 285041630, 311105466, 339515048, 370481492, 404234916, 441026148, 481128591, 524840254, 572485967, 624419793, 681027665, 742730244, 809986056, 883294891, 963201521, 1050299747, 1145236814, 1248718217, 1361512946, 1484459201, 1618470619, 1764543065, 1923762030, 2097310703, 2286478756, 2492671933, 2717422497, 2962400612, 3229426756, 3520485254, 0];var _ExpToNextLvl = [0, 500, 1000, 2250, 4125, 6300, 8505, 10206, 11510, 13319, 14429, 18036, 22545, 28181, 35226, 44033, 55042, 68801, 86002, 107503, 134378, 167973, 209966, 262457, 328072, 410090, 512612, 640765, 698434, 761293, 829810, 904492, 985897, 1074627, 1171344, 1276765, 1391674, 1516924, 1653448, 1802257, 1964461, 2141263, 2333976, 2544034, 2772997, 3022566, 3294598, 3591112, 3914311, 4266600, 4650593, 5069147, 5525370, 6022654, 6564692, 7155515, 7799511, 8501467, 9266598, 10100593, 11009646, 12000515, 13080560, 14257811, 15541015, 16939705, 18464279, 20126064, 21937409, 23911777, 26063836, 28409582, 30966444, 33753424, 36791232, 40102443, 43711663, 47645713, 51933826, 56607872, 61702579, 67255812, 73308835, 79906630, 87098226, 94937067, 103481403, 112794729, 122946255, 134011418, 146072446, 159218965, 173548673, 189168053, 206193177, 224750564, 244978115, 267026144, 291058498, 0];	_mylevel = me.getStat(12);	_exphead = _exp-_TotalExp[_mylevel];	//var _progressPercent = Math.floor(10000 * _exphead / _ExpToNextLvl[_mylevel])/100;	var _progressPercent=(_exphead / _ExpToNextLvl[_mylevel]*100).toFixed(2)+"%";	return _progressPercent;}function putpotion(){	if(beltcount("hp")==beltneedcount("hp") && beltcount("mp")==beltneedcount("mp"))return;		//SetUIState(0x01, true);		//delay( 400 ); 	var hpneed,mpneed,rvneed;	var hpput=0;	var mpput=0;	var rvput=0;	hpneed=beltneedcount("hp")-beltcount("hp");	mpneed=beltneedcount("mp")-beltcount("mp");	rvneed=beltneedcount("rv")-beltcount("rv");	var _item=me.getItems();	if(_item)	{		for(var n = 0 ; n < _item.length ; n++)        	{			if(_item[n].mode == 0 && _item[n].location == 3 && _item[n].itemType == 76 && hpput<hpneed)			{				clickItem(2, _item[n].x, _item[n].y, _item[n].location);				hpput++;				delay(5);			}			if(_item[n].mode == 0 && _item[n].location == 3 && _item[n].itemType == 77  && mpput<mpneed)			{				clickItem(2, _item[n].x, _item[n].y, _item[n].location);				mpput++;				delay(5);			}			if(_item[n].mode == 0 && _item[n].location == 3 && _item[n].itemType == 78  && rvput<rvneed)			{				clickItem(2, _item[n].x, _item[n].y, _item[n].location);				rvput++;				delay(5);			}			if(beltcount("hp")==beltneedcount("hp") && beltcount("mp")==beltneedcount("mp"))			{				return;			}			}	}	//me.cancel();	return;}function beltcount(type){	var _items,count,_type;	count=0;	_items = me.getItems();	if(!_items)		return 0;	if(type=='hp')_type=76;	else if(type=='mp')_type=77;	else if(type=='rv')_type=78;	else return 0;		for(var i = 0 ; i < _items.length ; i++)	{				if(_items[i].mode == 2 && _items[i].itemType==_type )			count++;	}	return count;}function beltneedcount(type){	var count,typecount,_type;	typecount=0;	if(type=='hp')_type=76;	else if(type=='mp')_type=77;	else if(type=='rv')_type=78;	else return 0;		for(var i = 0 ; i < 4 ; i++)	{				if(Config.BeltColumn[i]==type )			typecount++;	}	count=Storage.BeltSize()*typecount;	return count;}function checkbelt(){	var i;	for(i=0;i<4;i++)	{		Config.BeltColumn[i] = "hp";		Config.MinColumn[i] = 4;	}	var _items;	_items = me.getItems();	if(!_items)		return;	for(i = 0 ; i < _items.length ; i++)	{				if(_items[i].mode == 2 && _items[i].x < 4)		{			switch(_items[i].itemType)			{			case 76:				Config.BeltColumn[_items[i].x] = "hp";				break;			case 77:				Config.BeltColumn[_items[i].x] = "mp";				break;			case 78:				Config.BeltColumn[_items[i].x] = "rv";				Config.MinColumn[_items[i].x] = 0;				break;			}		}	}}function reportstat(_items){	var i,j;	var _report=[];		_report.push("item pickit code:\n");	for(i=0;i<700;i++)	{		if(_items.getStat(i)!=0)			_report.push(i+"("+numtostat(i)+") = "+_items.getStat(i));		if(i==16 || i==17 || i==18)		{			if(_items.getStat(i,0)!=0)				_report.push(i+",0"+"("+numtostat(i,0)+") = "+_items.getStat(i,0));		}		if(i==21 || i==22)		{			if(_items.getStat(i,1)!=0)				_report.push(i+",1"+"("+numtostat(i,1)+") = "+_items.getStat(i,1));		}		if(i==31)		{			if(_items.getStat(i,0)!=0)				_report.push(i+",0"+"("+numtostat(i,0)+") = "+_items.getStat(i,0));		}		if(i==83)		{			for(j=0;j<7;j++)			{					if(_items.getStat(i,j)!=0)					_report.push(i+","+j+"("+numtostat(i,j)+") = "+_items.getStat(i,j));				}		}		if(i==97 || i==107)		{			for(j=0;j<370;j++)			{					if(_items.getStat(i,j)!=0)					_report.push(i+","+j+"("+numtostat(i,j)+") = "+_items.getStat(i,j));				}		}		if(i==151)		{			for(j=0;j<16000;j++)			{					if(_items.getStat(i,j)!=0)					_report.push(i+","+j+"("+numtostat(i,j)+") = "+_items.getStat(i,j));				}		}		if(i==188)		{			for(j=0;j<55;j++)			{					if(_items.getStat(i,j)!=0)					_report.push(i+","+j+"("+numtostat(i,j)+") = "+_items.getStat(i,j));				}		}		if(i==198)		{			for(j=0;j<16000;j++)			{					if(_items.getStat(i,j)!=0)					_report.push(i+","+j+"("+numtostat(i,j)+") = "+_items.getStat(i,j));				}		}		if(i==204)		{			for(j=0;j<16000;j++)			{					if(_items.getStat(i,j)!=0)					_report.push(i+","+j+"("+numtostat(i,j)+") = "+_items.getStat(i,j));				}		}	}	var _last = _report.reverse().join("\n");	return _last;}function numtostat(num1,num2){	var stat="";	if( arguments.length < 2 )	{		for( var obj in NTIPAliasStat )		{			if(NTIPAliasStat[obj]==num1)			{				if(stat=="")					stat = obj;				else					stat=stat+"||"+obj;			}		}	}	else	{		for( var obj in NTIPAliasStat )		{			if(NTIPAliasStat[obj].constructor==Array && NTIPAliasStat[obj][0]==num1 && NTIPAliasStat[obj][1]==num2)			{				if(stat=="")					stat = obj;				else					stat=stat+"||"+obj;			}		}	}	return stat;}function report(_items){	var _report=[];		_report.push("ilevel = "+_items.ilvl+", "+"classid = "+_items.classid+", color = "+_items.getColor());	_report.push("type = "+_items.itemType+", "+" class = "+_items.itemclass+", "+" quality = "+_items.quality);	_report.push("suffix = "+_items.suffixnum+", "+" prefix = "+_items.prefixnum);	_report.push("code = "+_items.code+", gid = "+_items.gid+", gfx = "+_items.gfx);	_report.push("sell value = "+_items.getItemCost(1)+", "+"buy cost = "+_items.getItemCost(0));			//reportiteminfo(_items);	if(checkcount(_items.classid)>0)_report.push("I have "+(checkcount(_items.classid)+1)+ " pieces of this item.");				var _last = _report.reverse().join("\n");	return _last;}function checkcount(itemclassid){		var _item=me.getItems();		var count=0;		if(_item)		{		for(var n = 0 ; n < _item.length ; n++)        		{				if(_item[n].classid == itemclassid )				{					count++;				}			}		}				return count;}function pgxi(cid) {	var item = me.getItem(cid);	if (Cubing.emptyCube() && Cubing.openCube() && Storage.Cube.MoveTo(item)) {		while (!Pickit.checkItem(item).result || Pickit.checkItem(item).result == 4) {			if (!me.getItem(568) && !me.getItem(573)&& !me.getItem(578) && !me.getItem(583) && !me.getItem(588) && !me.getItem(593) && !me.getItem(608)) {				if (me.getItem(666)) {					clickItem(1, me.getItem(666));					delay(100);				}			}			if (me.getItem(568)) {				var pg = me.getItem(568);			} else if (me.getItem(573)) {				var pg = me.getItem(573);			} else if (me.getItem(578)) {				var pg = me.getItem(578);			} else if (me.getItem(583)) {				var pg = me.getItem(583);			} else if (me.getItem(588)) {				var pg = me.getItem(588);			} else if (me.getItem(593)) {				var pg = me.getItem(593);			} else if (me.getItem(608)) {				var pg = me.getItem(608);			}			if (Storage.Cube.MoveTo(pg)) {				transmute();				delay(100);			}			var item = me.findItem(cid,-1,6);			delay(100);		}	}}function getrune(rune) {	var i,j		if (!me.getItem(rune)) {			for (i = rune; i < 650; i+= 1) {				//say(i);				if (me.getItem(i)) {					j = i;					break;				}			}			for (i = j; i > rune; i--) {				while (!me.getItem(i)) {					delay(100);				}				if (me.getItem(i)) {					while (true) {						clickItem(1, me.getItem(i))						delay(200);						if (me.getItem(i-1)) {							break;						}					}					}			}		}}function tocube(cid,num) {	var i,		item = me.findItems(cid,-1,7);//Inventory 3 | Cube 6 | Stash 7	for (i = 0; i < Math.min(item.length,num); i+= 1) {		Storage.Cube.MoveTo(item[i]);	}		item = me.findItems(cid,-1,6);	var info=[];	info.push("ToCube "+ i +" items,classid = "+cid);	info.push("InCube "+ item.length +" items,classid = "+cid);	var p = info.reverse().join("\n");	pri(p,2);}function toStash(cid) {	var i,		item = me.findItems(cid,-1,3);//Inventory 3 | Cube 6 | Stash 7	for (i = 0; i < item.length; i+= 1) {		Storage.Stash.MoveTo(item[i]);	}}function toInventory(cid,stat) {	var i,		item = me.findItems(cid,-1,7);//Inventory 3 | Cube 6 | Stash 7	for (i = 0; i < item.length; i+= 1) {		if (item[i].getStat(stat) >= 1) {			Storage.Inventory.MoveTo(item[i]);		}	}}function showareainfo(){	var info=[];	var n;	info.push("AreaID:"+me.area+", "+"Level:"+maplevel(me.area)+", X = " + me.x + ", Y = " + me.y);	//toInventory(650,36);	//toInventory(650,34);	//tocube(664,50);	//tocube(712,30);	//toStash(650);	pgxi(422);	//getrune(635);	/*for(n=0;n<3000;n++) {		if (me.getState(n)) {			say(n);		}	}	for(n=0;n<7;n++)			info.push('AttackSkill['+n+']='+Config.AttackSkill[n]+","+getSkillById(Config.AttackSkill[n]));	for(n=0;n<4;n++)		info.push('Config.BeltColumn['+n+']='+Config.BeltColumn[n]);			info.push(getNearestPreset()); 	var _target = getUnit(1);	var monlist = [];	if(!_target)	{		var _last = info.reverse().join("\n");		pri(_last,0,10,480,4,3);		return; 	}	do	{		if(Attack.checkMonster(_target))			monlist.push(copyUnit(_target));	} while(_target.getNext());	for(var i=0;i<monlist.length;i++)	{       		for(var j=i+1;j<monlist.length;j++)		{          			if(monlist[j].name==monlist[i].name)            		{				monlist.splice(j,1);              			j--;            		}                 		}   	}  	for(var i=0;i<monlist.length;i++)	{		_target = monlist[i];		info.push(	'id:['+_target.classid+			'] hp:['+_target.hp+			'] [FR'+_target.getStat(39)+			',CR'+_target.getStat(43)+			',LR'+_target.getStat(41)+			',PR'+_target.getStat(45)+			',DR'+_target.getStat(36)+			',MR'+_target.getStat(37)+			'range:['+getDistance(me, _target).toFixed(0)+',x:'+(_target.x-me.x)+',y:'+(_target.y-me.y)+'] '+			'name:'+_target.name			+',lvl-'+_target.getStat(12)							);	}*/	var _last = info.reverse().join("\n");	pri(_last,0,10,480,4,3);	}function maplevel(mapid){	if(me.gametype)		return (getBaseStat("levels",me.area,"MonLvl"+(me.diff+1)+"Ex"));	else		return (getBaseStat("levels",me.area,"MonLvl"+(me.diff+1)));}function getNearestPreset() {		var i, unit, dist, id;		unit = getPresetUnits(me.area);		dist = 99;		for (i = 0; i < unit.length; i += 1) {			if (getDistance(me, unit[i].roomx * 5 + unit[i].x, unit[i].roomy * 5 + unit[i].y) < dist) {				dist = getDistance(me, unit[i].roomx * 5 + unit[i].x, unit[i].roomy * 5 + unit[i].y);				id = "type="+unit[i].type + ", id=" + unit[i].id+", range="+getDistance(me, unit[i].roomx * 5 + unit[i].x, unit[i].roomy * 5 + unit[i].y);			}		}		return "Nearest unit: "+id || "";}function followleader(){	var result;	leaderUnit = getLeaderUnit(drivername);	if(!leaderUnit)return false;	if(getDistance(me.x, me.y, leaderUnit.x, leaderUnit.y) <= 60){		if(getDistance(me.x, me.y, leaderUnit.x, leaderUnit.y) >=5)			Pather.moveToUnit(leaderUnit);		pickPotions(20);		pickgold(20);		pickArrow(20);		if (canfire) {			Attack.clear(20, false, false, false, false);		}	}	if (me.classid === 3 && Config.AttackSkill[2] > 0) {		Skill.setSkill(Config.AttackSkill[2], 0);	}	if (leader.area !== me.area && !me.inTown) {		while (leader.area === 0) {			delay(100);		}    		result = checkExit(leader, leader.area);    		switch (result) {		case 1:			//say("Taking exit.");			delay(500);			Pather.moveToExit(leader.area, true);    			break;		case 2:			//say("Taking portal.");    			break;		case 3:			//say("Taking waypoint.");			delay(500);			Pather.useWaypoint(leader.area, true);    			break;		case 4:			//say("Special transit.");    			break;		}	}	return true;}function farfollowleader(){	leaderUnit = getLeaderUnit(drivername);	if(leaderUnit && getDistance(me.x, me.y, leaderUnit.x, leaderUnit.y) <= 90){		Attack.getIntoPosition(leaderUnit, followrange, 0x4);		pickPotions(20);		if (canfire) {			Attack.clear(20, false, false, false, false);		}		}}function checkExit(unit, area){	if (unit.inTown) {		return false;	}	var i, target,		exits = getArea().exits;	for (i = 0; i < exits.length; i += 1) {		if (exits[i].target === area) {			return 1;		}	}	if (unit.inTown) {		target = getUnit(2, "waypoint");		if (target && getDistance(me, target) < 20) {			return 3;		}	}	target = getUnit(2, "portal");	if (target) {		do {			if (target.objtype === area) {				Pather.usePortal(null, null, target);				return 2;			}		} while (target.getNext());	}	// Arcane<->Cellar portal	if ((me.area === 74 && area === 54) || (me.area === 54 && area === 74)) {		Pather.usePortal(null);		return 4;	}	// Tal-Rasha's tomb->Duriel's lair	if (me.area >= 66 && me.area <= 72 && area === 73) {		Pather.useUnit(2, 100, area);		return 4;	}	// Throne->Chamber	if (me.area === 131 && area === 132) {		target = getUnit(2, 563);		if (target) {			Pather.usePortal(null, null, target);			return 4;		}	}	return false;}function passact(act,iamkeychar) {	if (iamkeychar === undefined) 		iamkeychar = false;			var npc, preArea, target;	preArea = me.area;	switch (act) {	case 1:		if (me.area >= 40) {			break;		}		if(me.area==37){			Pather.usePortal(1, null);					}		Town.move("warriv");		npc = getUnit(1, 155);		if (npc) {			npc.openMenu();			Misc.useMenu(0x0D36);		}		while (!me.area)delay(500);		delay(1000);		if (me.area ===40) {			say("arrive act2.");		}		else{			me.cancel();			say("Act change failed.");				return false;		}				if(iamkeychar){			Town.move("portalspot");			say("act1 over");			if(Pather.usePortal(44, drivername)){				Town.goToTown();				say("city door open");			}		}					else{			delay(3000);			npc = getUnit(1, getLocaleString(3027));			if (npc && getDistance(me,npc)<=15) {				npc.openMenu();				me.cancel();			}			Town.move("palace");		}		break;	case 2:		if (me.area >= 75) {			break;		}		if(me.area==73){			Pather.usePortal(40, null);				if(Pather.usePortal(50, null))				Pather.moveToExit(40, true);			}		npc = getUnit(1, getLocaleString(3027));		if(!npc){			Town.move("palace");			npc = getUnit(1, getLocaleString(3027));		}		if (npc) {			npc.openMenu();			me.cancel();		}		if(palacedoor){			Pather.moveToExit(50, true);			Pather.usePortal(40, null);		}		Town.move("meshif");		npc = getUnit(1, 210);		if (npc) {			npc.openMenu();			Misc.useMenu(0x0D38);		}		while (!me.area)delay(500);		delay(1000);		if (me.area ===75) {			say("arrive act3.");		}		else{			me.cancel();			say("Act change failed.");				return false;		}		Town.move("portalspot");		if(iamkeychar)say("keychar ready");		break;	case 3:		if (me.area >= 103) {			break;		}		if (me.inTown) {			if(!me.getQuest(21,0)){				Town.move("cain");				npc = getUnit(1, 245);				if (npc) {					npc.openMenu();					me.cancel();				}			}			Town.move("portalspot");			Pather.usePortal(102, drivername);		}		delay(1500);		target = getUnit(2, 342);		if (target) {			Pather.moveTo(target.x - 3, target.y - 1);		}		Pather.usePortal(null);		while (!me.area)delay(500);		delay(1000);		if (me.area ===103) {			say("arrive act4.");		}		else{			me.cancel();			say("Act change failed.");				return false;		}		break;	case 4:		if (me.area >= 109) {			break;		}		Town.move(NPC.Tyrael); 		target = getUnit(1, getLocaleString(1013));		if (target && target.openMenu()) {			me.cancel();			say("talked "+target.classid);		}		try {			Pather.useUnit(2, 566, 109);		} catch (a5e) {		}		while (!me.area)delay(500);		delay(1000);		if (me.area ===109) {			say("arrive act5.");		}		else{			me.cancel();			say("Act change failed.");				return false;		}		break;	}	return true;}function pickPotions(range) {	if(range===undefined)		range=20;	if (me.dead) {		return false;	}				//Town.clearBelt();	while (!me.idle) {		delay(40);	}		var pickList = [],		item = getUnit(4);		if (item) {		do {			if ((item.mode === 3 || item.mode === 5) && item.itemType >= 76 && item.itemType <= 78 && getDistance(me, item) <= range) {				pickList.push(copyUnit(item));			}		} while (item.getNext());	}		pickList.sort(Pickit.sortItems);		while (pickList.length > 0) {		item = pickList.shift();			if (item && copyUnit(item).x) {			if (myfreespace()>=16) {				sendPacket(1, 0x16, 4, 0x4, 4, item.gid, 4, 0);					//Pickit.pickItem(item, status);			}		}	}		return true;}function pickgold(range) {	if(range===undefined)		range=20;	if (me.dead) {		return false;	}				//Town.clearBelt();	while (!me.idle) {		delay(40);	}		var pickList = [],		item = getUnit(4,523);		if (item) {		do {			if ((item.mode === 3 || item.mode === 5) && getDistance(me, item) <= range) {				pickList.push(copyUnit(item));			}		} while (item.getNext());	}		pickList.sort(Pickit.sortItems);		while (pickList.length > 0) {		item = pickList.shift();			if (item && copyUnit(item).x) {			if (me.getStat(14) < me.getStat(12) * 10000) {				sendPacket(1, 0x16, 4, 0x4, 4, item.gid, 4, 0);					//Pickit.pickItem(item, status);			}		}	}		return true;}function pickArrow(range) {	var arrowid;	switch(Attack.usingBow()){	case "bow":		arrowid=526;		break;	case "crossbow":		arrowid=528;		break;	default:		return false;		break;	}	if(myfreespace()<=16)return false;	if(range===undefined)		range=20;	if (me.dead) {		return false;	}				//Town.clearBelt();			while (!me.idle) {		delay(40);	}		var pickList = [],		item = getUnit(4);		if (item) {		do {			if ((item.mode === 3 || item.mode === 5) && item.classid==arrowid && getDistance(me, item) <= range) {				pickList.push(copyUnit(item));			}		} while (item.getNext());	}		pickList.sort(Pickit.sortItems);		while (pickList.length > 0) {		item = pickList.shift();			if (item && copyUnit(item).x) {			if (myfreespace()>=16) {				sendPacket(1, 0x16, 4, 0x4, 4, item.gid, 4, 0);					//Pickit.pickItem(item, status);			}		}	}		return true;}function pickNear(range,onlyone) {	if(range===undefined)		range=20;	if(onlyone===undefined)		onlyone=false;	if (me.dead) {		return false;	}				//Town.clearBelt();	while (!me.idle) {		delay(40);	}	var pickList = [],	item = getUnit(4);	if (item) {		do {			if ((item.mode === 3 || item.mode === 5) && getDistance(me, item) <= range) {				sendPacket(1, 0x16, 4, 0x4, 4, item.gid, 4, 0);					if(onlyone)break;			}		} while (item.getNext());	}	return true;}function myfreespace(){	var i, x, y;	var _items;	var _blank=0;	var _invspace = new Array(4);	for(y = 0 ; y < 4 ; y++)		_invspace[y] = new Array(10);	for(y = 0 ; y < 4 ; y++)	{		for(x = 0 ; x < 10 ; x++)			_invspace[y][x] = 0;	}	_items = me.getItems();	if(!_items)		return false;	for(i = 0 ; i < _items.length ; i++)	{		if(_items[i].mode == 0 && _items[i].location == 3)		{			for(y = 0 ; y < _items[i].sizey ; y++)			{				for(x = 0 ; x < _items[i].sizex ; x++)					_invspace[y+_items[i].y][x+_items[i].x] = 1;			}		}	}	for(y = 0 ; y < 4 ; y++)	{		for(x = 0 ; x < 10 ; x++)			if(_invspace[y][x]==0)			_blank++;	}	return _blank;}function dotorch(){	var i;	var _aura;	_aura = me.getSkill(123, 1)>=20?123:125;	Config.AttackSkill[1] = 97;	Config.AttackSkill[2] = _aura;	Pather.moveTo(25068, 5078);	Precast.doPrecast(true);	var findLoc = [25040, 5101, 25040, 5166, 25122, 5170];	for (i = 0; i < findLoc.length; i += 2) {		Pather.moveTo(findLoc[i], findLoc[i + 1]);	}	Skill.setSkill(_aura, 0);	lure(704);	Pather.moveTo(25129, 5198);	Skill.setSkill(_aura, 0);	lure(704);	if (!getUnit(1, 704)) {		Pather.moveTo(25122, 5170);	}	Attack.kill(704);	Config.AttackSkill[1] = 97;	Config.AttackSkill[2] = 122;	Pather.moveTo(25162, 5141);	delay(3250);	if (!getUnit(1, 709)) {		Pather.moveTo(25122, 5170);	}	Attack.kill(709);	if (!getUnit(1, 705)) {		Pather.moveTo(25122, 5170);	}	Attack.kill(705);	Pickit.pickItems();	Pather.moveTo(25105, 5140);	Pather.usePortal(109);}function lure(bossId) {	var tick,	unit = getUnit(1, bossId);	if (unit) {		tick = getTickCount();		while (getTickCount() - tick < 2000) {			if (getDistance(me, unit) <= 10) {				return true;			}				delay(50);		}	}	return false;}function getAreaName(area) {	var areas = ["None"];	var i;	for(i=5055;i>=5018;i--)	{		areas.push(getLocaleString(i));	}	areas.push(getLocaleString(788));	for(i=852;i>=827;i--)	{		areas.push(getLocaleString(i));	}	for(i=0;i<7;i++)	{		areas.push(getLocaleString(826)+"#"+(i+1));	}	areas.push(getLocaleString(825));	areas.push(getLocaleString(824));	for(i=820;i>=812;i--)	{		areas.push(getLocaleString(i));	}	areas.push(getLocaleString(810));	areas.push(getLocaleString(811));	areas.push(getLocaleString(809));	areas.push(getLocaleString(808));	areas.push(getLocaleString(806));	areas.push(getLocaleString(805));	areas.push(getLocaleString(807));	areas.push(getLocaleString(804));	areas.push(getLocaleString(845));	areas.push(getLocaleString(844));	for(i=803;i>=795;i--)	{		areas.push(getLocaleString(i));	}	areas.push(getLocaleString(790));	areas.push(getLocaleString(792));	areas.push(getLocaleString(793));	areas.push(getLocaleString(794));	areas.push(getLocaleString(791));	areas.push(getLocaleString(789));	for(i=22646;i<=22660;i++)	{		areas.push(getLocaleString(i));	}	areas.push(getLocaleString(22662));	areas.push(getLocaleString(21865));	areas.push(getLocaleString(21866));	areas.push(getLocaleString(21867));	areas.push(getLocaleString(22663));	areas.push(getLocaleString(22664));	areas.push(getLocaleString(22665));	areas.push(getLocaleString(22667));	areas.push(getLocaleString(22666));	areas.push(getLocaleString(11155));	areas.push(getLocaleString(11156));	areas.push(getLocaleString(11157));	areas.push(getLocaleString(5018));	return areas[area];}function setmyskill(main) {	var info=["set these skills :\n"];	if(main){		switch(me.classid)		{		case 0://ama		case 1://sor		case 2://nec		case 5://dur		case 6://asn			Config.AttackSkill[1] = me.getSkill(2);			Config.AttackSkill[2] = me.getSkill(3);			Config.AttackSkill[3] = me.getSkill(2);			Config.AttackSkill[4] = me.getSkill(3);			break;		case 3://pal			Config.AttackSkill[1] = me.getSkill(3);			Config.AttackSkill[2] = me.getSkill(2);			Config.AttackSkill[3] = me.getSkill(3);			Config.AttackSkill[4] = me.getSkill(2);			break;		case 4://bar			Config.AttackSkill[1] = me.getSkill(2);			Config.AttackSkill[3] = me.getSkill(2);			break;		}	}	else	{		switch(me.classid)		{		case 0://ama		case 1://sor		case 2://nec		case 5://dur		case 6://asn			Config.AttackSkill[5] = me.getSkill(2);			Config.AttackSkill[6] = me.getSkill(3);			break;		case 3://pal			Config.AttackSkill[5] = me.getSkill(3);			Config.AttackSkill[6] = me.getSkill(2);			break;		case 4://bar			Config.AttackSkill[2] = me.getSkill(2);			Config.AttackSkill[4] = me.getSkill(2);			break;		}	}	for(var n=0;n<7;n++)		info.push('AttackSkill['+n+']='+Config.AttackSkill[n]+","+getSkillById(Config.AttackSkill[n]));	var _last = info.reverse().join("\n");	pri(_last,0,10,480,4,3);	saveskill();}function saveskill(){	var _skill="";	for(var n=0;n<7;n++){		_skill += "Config.AttackSkill["+n+"] = "+Config.AttackSkill[n]+"\n";		}	FileTools.writeText("tools/maplog/"+me.name+"_skill.txt",_skill);}function readskill(){	if(FileTools.exists("tools/maplog/"+me.name+"_skill.txt"))		eval(FileTools.readText("tools/maplog/"+me.name+"_skill.txt"));}function checkLeaderAct(unit) {	if (unit.area <= 39) {		return 1;	}	if (unit.area >= 40 && unit.area <= 74) {		return 2;	}	if (unit.area >= 75 && unit.area <= 102) {		return 3;	}	if (unit.area >= 103 && unit.area <= 108) {		return 4;	}	return 5;}function autoChant(lowmanamode) {	if(lowmanamode==undefined)		lowmanamode=false;	var unit,		chanted = [];	// Player	unit = getUnit(0);	if (unit) {		do {			if(me.mp<(me.getSkill(52, 1)+24))break;			if (unit.name !== me.name && !unit.dead && Misc.inMyParty(unit.name) && getDistance(me, unit) <= 40) {				Skill.setSkill(52, 0);				if(!lowmanamode || (lowmanamode && !unit.getState(16)))					sendPacket(1, 0x11, 4, unit.type, 4, unit.gid);				delay(500);				chanted.push(unit.name);			}		} while (unit.getNext());	}	// Minion	unit = getUnit(1);	if (unit) {		do {			if(me.mp<(me.getSkill(52, 1)+24))break;			if (unit.getParent() && chanted.indexOf(unit.getParent().name) > -1 && getDistance(me, unit) <= 40) {				Skill.setSkill(52, 0);				if(!lowmanamode || (lowmanamode && !unit.getState(16)))					sendPacket(1, 0x11, 4, unit.type, 4, unit.gid);				delay(500);			}		} while (unit.getNext());	}	return true;}function ShopBot() {	var i, tickCount,		cycles = 0,		cyclesText = new Text("Cycles in last minute:", 50, 260, 2, 1),		title = new Text("kolbot shopbot", 50, 245, 2, 1),		frequency = new Text("Valid item frequency:", 50, 275, 2, 1),		totalCyclesText = new Text("Total cycles:", 50, 290, 2, 1),		validItems = 0,		leadRetry = 10,		totalCycles = 0,		leadTimeout = 20; // NPC move timeout in seconds	this.pickEntries = [];	this.npcs = {};	this.paths = {};	this.buildPickList = function () {		var i, nipfile, line, lines, info,			filepath = "pickit/shopbot.nip",			filename = filepath.substring(filepath.lastIndexOf("/") + 1, filepath.length);		if (!FileTools.exists(filepath)) {			Misc.errorReport("c1NIP file doesn't exist: c0" + filepath);			return false;		}		try {			nipfile = File.open(filepath, 0);		} catch (fileError) {			Misc.errorReport("c1Failed to load NIP: c0" + filename);		}		if (!nipfile) {			return false;		}		lines = nipfile.readAllLines();		nipfile.close();		for (i = 0; i < lines.length; i += 1) {			info = {				line: i + 1,				file: filename,				string: lines[i]			};			line = NTIP.ParseLineInt(lines[i], info);			if (line) {				this.pickEntries.push(line);			}		}		return true;	};	this.processPath = function (npc, path) {		var i,			cutIndex = 0,			dist = 100;		for (i = 0; i < path.length; i += 2) {			if (getDistance(npc, path[i], path[i + 1]) < dist) {				cutIndex = i;				dist = getDistance(npc, path[i], path[i + 1]);			}		}		return path.slice(cutIndex);	};	this.mover = function (npc, path) {		var i, j;		path = this.processPath(npc, path);		if (path.length === 2 && getDistance(npc.x, npc.y, path[0], path[1]) < 4) {			return true;		}		for (i = 0; i < path.length; i += 2) {			if (i === path.length - 2) {				Pather.moveTo(path[i] - 3, path[i + 1] - 3);			} else {				Pather.moveTo(path[i], path[i + 1]);			}			moveNPC(npc, path[i], path[i + 1]);			for (j = 0; j < leadTimeout; j += 1) {				while (npc.mode === 2) {					delay(100);				}				if (getDistance(me, npc) < (i === path.length - 2 ? 8 : 5)) {					break;				}				if (j > 0 && j % leadRetry === 0) {					moveNPC(npc, path[i], path[i + 1]);				}				delay(1000);			}			if (j === leadTimeout) {				return false;			}		}		delay(1000);		return true;	};	this.openMenu = function (npc) {		if (npc.type !== 1) {			throw new Error("Unit.openMenu: Must be used on NPCs.");		}		var i, tick,			interactedNPC = getInteractedNPC();		if (interactedNPC && interactedNPC.name !== npc.name) {			sendPacket(1, 0x30, 4, interactedNPC.type, 4, interactedNPC.gid);			me.cancel();		}		if (getUIFlag(0x08)) {			return true;		}		for (i = 0; i < 10; i += 1) {			if (getDistance(me.x, me.y, npc.x, npc.y) > 5) {				Pather.walkTo(npc.x, npc.y);			}			if (!getUIFlag(0x08)) {				sendPacket(1, 0x13, 4, 1, 4, npc.gid);				sendPacket(1, 0x2f, 4, 1, 4, npc.gid);			}			tick = getTickCount();			while (getTickCount() - tick < Math.max(Math.round((i + 1) * 250 / (i / 3 + 1)), me.ping + 1)) {				if (getUIFlag(0x08)) {					//print("openMenu try: " + i);					return true;				}				delay(10);			}		}		me.cancel();		return false;	};	this.shopItems = function (npc, menuId) {		var i, item, items, bought;		if (!Storage.Inventory.CanFit({sizex: 2, sizey: 4}) && AutoMule.getMuleItems().length > 0) {			D2Bot.printToConsole("Mule triggered");			scriptBroadcast("mule");			scriptBroadcast("quit");			return true;		}		if (!npc) {			return false;		}		for (i = 0; i < 10; i += 1) {			delay(150);			if (i % 2 === 0) {				sendPacket(1, 0x38, 4, 1, 4, npc.gid, 4, 0);			}			if (npc.itemcount > 0) {				//delay(200);				break;			}		}		item = npc.getItem();		if (!item) {			return false;		}		items = [];		do {			if (Config.ShopBot.ScanIDs.indexOf(item.classid) > -1 || Config.ShopBot.ScanIDs.length === 0) {				items.push(copyUnit(item));			}		} while (item.getNext());		pri(npc.itemcount + " items, " + items.length + " valid");		validItems += items.length;		frequency.text = "Valid base items / cycle: " + ((validItems / totalCycles).toFixed(2).toString());		for (i = 0; i < items.length; i += 1) {			if (Storage.Inventory.CanFit(items[i]) && Pickit.canPick(items[i]) &&					me.gold >= items[i].getItemCost(0) &&					NTIP.CheckItem(items[i], this.pickEntries)					) {				beep();				D2Bot.printToConsole("Match found!", 7);				delay(1000);				if (npc.startTrade(menuId)) {					Misc.logItem("Shopped", items[i]);					items[i].buy();					bought = true;				}				if (Config.ShopBot.QuitOnMatch) {					scriptBroadcast("quit");				}			}		}		if (bought) {			me.cancel();			Town.stash();		}		return true;	};	this.useWp = function (area) {		if (totalCycles === 0) {			me.cancel();			return Pather.useWaypoint(area, true);		}		var i, tick, unit, interactedNPC;		if (me.area === area) {			return true;		}		unit = getUnit(2, "waypoint");		if (!unit) {			return false;		}		if (getUIFlag(0x08)) {			interactedNPC = getInteractedNPC();			if (interactedNPC) {				sendPacket(1, 0x30, 4, interactedNPC.type, 4, interactedNPC.gid);			}			me.cancel();		}		for (i = 0; i < 10; i += 1) {			if (me.area === unit.area && getDistance(me, unit) > 5) {				Pather.walkTo(unit.x, unit.y);			}			unit.interact(area);			tick = getTickCount();			while (getTickCount() - tick < Math.max(Math.round((i + 1) * 250 / (i / 3 + 1)), me.ping + 1)) {				if (me.area === area) {					return true;				}				delay(10);			}		}		return false;	};	this.shopAtNPC = function (name) {		var i, path, npc, menuId, wp, temp;		switch (name) {		case "akara":			if (me.inTown) {				if (!Town.goToTown(1)) {					break;				}			} else {				if (!this.useWp(1)) {					break;				}			}			npc = this.npcs[name] || getUnit(1, getLocaleString(2892));			if (!npc) {				Town.move(NPC.Akara);				npc = getUnit(1, getLocaleString(2892));			}			if (!npc) {				Town.move("waypoint");				npc = getUnit(1, getLocaleString(2892));			}			if (!npc) {				break;			}			if (!this.npcs[name]) {				this.npcs[name] = copyUnit(npc);			}			if (!this.paths[name]) {				if (!getUnit(2, "waypoint")) {					Town.move("waypoint");				}				wp = getUnit(2, "waypoint");				wp = {x: wp.x, y: wp.y};				Town.move(NPC.Akara);				path = getPath(me.area, npc.x, npc.y, wp.x + 2, wp.y + 2, 0, 8);				this.paths[name] = [];				for (i = 0; i < path.length; i += 1) {					temp = Pather.getNearestWalkable(path[i].x, path[i].y, 5, 1, 0x1 | 0x400, 4);					if (temp) {						this.paths[name] = this.paths[name].concat(temp);					} else {						this.paths[name].push(path[i].x);						this.paths[name].push(path[i].y);					}				}			}			path = this.paths[name];			menuId = "Shop";			break;		case "elzix":			if (me.inTown) {				if (!Town.goToTown(2)) {					break;				}			} else {				if (!this.useWp(40)) {					break;				}			}			npc = this.npcs[name] || getUnit(1, NPC.Elzix);			if (!npc) {				Town.move(NPC.Elzix);				npc = getUnit(1, NPC.Elzix);			}			if (!npc) {				Town.move("waypoint");				npc = getUnit(1, NPC.Elzix);			}			if (!npc) {				break;			}			if (!this.npcs[name]) {				this.npcs[name] = copyUnit(npc);			}			path = [5038, 5099, 5059, 5102, 5068, 5090, 5067, 5086];			menuId = "Shop";			break;		case "fara":			if (me.inTown) {				if (!Town.goToTown(2)) {					break;				}			} else {				if (!this.useWp(40)) {					break;				}			}			npc = this.npcs[name] || getUnit(1, NPC.Fara);			if (!npc) {				Town.move(NPC.Fara);				npc = getUnit(1, NPC.Fara);			}			if (!npc) {				Town.move("waypoint");				npc = getUnit(1, NPC.Fara);			}			if (!npc) {				break;			}			if (!this.npcs[name]) {				this.npcs[name] = copyUnit(npc);			}			path = [5112, 5094, 5092, 5096, 5078, 5098, 5070, 5085];			menuId = "Repair";			break;		case "drognan":			if (me.inTown) {				if (!Town.goToTown(2)) {					break;				}			} else {				if (!this.useWp(40)) {					break;				}			}			npc = this.npcs[name] || getUnit(1, NPC.Drognan);			if (!npc) {				Town.move(NPC.Drognan);				npc = getUnit(1, NPC.Drognan);			}			if (!npc) {				Town.move("waypoint");				npc = getUnit(1, NPC.Drognan);			}			if (!npc) {				break;			}			if (!this.npcs[name]) {				this.npcs[name] = copyUnit(npc);			}			path = [5093, 5049, 5088, 5060, 5093, 5079, 5078, 5087, 5070, 5085];			menuId = "Shop";			break;		case "ormus":			if (me.inTown) {				if (!Town.goToTown(3)) {					break;				}			} else {				if (!this.useWp(75)) {					break;				}			}			npc = this.npcs[name] || getUnit(1, NPC.Ormus);			if (!npc) {				Town.move(NPC.Ormus);				npc = getUnit(1, NPC.Ormus);			}			if (!npc) {				Town.move("waypoint");				npc = getUnit(1, NPC.Ormus);			}			if (!npc) {				break;			}			if (!this.npcs[name]) {				this.npcs[name] = copyUnit(npc);			}			path = [5135, 5093, 5147, 5089, 5156, 5075, 5157, 5063, 5160, 5050];			menuId = "Shop";			break;		case "asheara":			if (me.inTown) {				if (!Town.goToTown(3)) {					break;				}			} else {				if (!this.useWp(75)) {					break;				}			}			npc = this.npcs[name] || getUnit(1, NPC.Asheara);			if (!npc) {				Town.move(NPC.Asheara);				npc = getUnit(1, NPC.Asheara);			}			if (!npc) {				Town.move("waypoint");				npc = getUnit(1, NPC.Asheara);			}			if (!npc) {				break;			}			if (!this.npcs[name]) {				this.npcs[name] = copyUnit(npc);			}			path = [5049, 5093, 5067, 5092, 5084, 5093, 5110, 5093, 5132, 5093, 5147, 5086, 5154, 5070, 5160, 5049];			menuId = "Shop";			break;		case "anya":			if (me.inTown) {				if (!Town.goToTown(5)) {					break;				}			} else {				if (!this.useWp(109)) {					break;				}			}			npc = this.npcs[name] || getUnit(1, NPC.Anya);			if (!npc) {				Town.move(NPC.Anya);				npc = getUnit(1, NPC.Anya);			}			if (!npc) {				Town.move("waypoint");				npc = getUnit(1, NPC.Anya);			}			if (!npc) {				break;			}			if (!this.npcs[name]) {				this.npcs[name] = copyUnit(npc);			}			path = [5122, 5119, 5129, 5105, 5123, 5087, 5115, 5070];			menuId = "Shop";			break;		default:			throw new Error("Invalid NPC");		}		if (npc) {			if (!this.mover(npc, path)) {				return false;			}			if (Config.ShopBot.CycleDelay) {				delay(Config.ShopBot.CycleDelay);			}			if (this.openMenu(npc)) {				this.shopItems(npc, menuId);			}		}		return true;	};	// START	for (i = 0; i < Config.ShopBot.ScanIDs.length; i += 1) {		if (isNaN(Config.ShopBot.ScanIDs[i])) {			if (NTIPAliasClassID.hasOwnProperty(Config.ShopBot.ScanIDs[i].replace(/\s+/g, "").toLowerCase())) {				Config.ShopBot.ScanIDs[i] = NTIPAliasClassID[Config.ShopBot.ScanIDs[i].replace(/\s+/g, "").toLowerCase()];			} else {				Misc.errorReport("c1Invalid ShopBot entry:c0 " + Config.ShopBot.ScanIDs[i]);				Config.ShopBot.ScanIDs.splice(i, 1);				i -= 1;			}		}	}	if (typeof Config.ShopBot.ShopNPC === "string") {		Config.ShopBot.ShopNPC = [Config.ShopBot.ShopNPC];	}	for (i = 0; i < Config.ShopBot.ShopNPC.length; i += 1) {		Config.ShopBot.ShopNPC[i] = Config.ShopBot.ShopNPC[i].toLowerCase();	}	if (Config.ShopBot.MinGold && me.getStat(14) + me.getStat(15) < Config.ShopBot.MinGold) {		return true;	}	this.buildPickList();	print("Shopbot: Pickit entries: " + this.pickEntries.length);	Config.HPBuffer = 0;	Config.MPBuffer = 0;		Town.doChores();	Config.HPBuffer = 20;	Config.MPBuffer = 10;	tickCount = getTickCount();	while (!Config.ShopBot.Cycles || totalCycles < Config.ShopBot.Cycles) {		if (getTickCount() - tickCount >= 60 * 1000) {			cyclesText.text = "Cycles in last minute: " + cycles.toString();			totalCyclesText.text = "Total cycles: " + totalCycles.toString();			cycles = 0;			tickCount = getTickCount();		}		for (i = 0; i < Config.ShopBot.ShopNPC.length; i += 1) {			this.shopAtNPC(Config.ShopBot.ShopNPC[i]);		}		if (me.inTown) {			this.useWp([35, 48, 101, 107, 113][me.act - 1]);		}		cycles += 1;		totalCycles += 1;	}	return true;}function checknpc(){	var npc = getInteractedNPC();	if(!npc)return false;	var npcname = [ "akara",   "charsi", "gheed",                           "drognan", "fara",   "elzix",                           "ormus",   "hratli", "asheara",                        "jamella", "halbu" ,                        "anya",    "larzuk", "malah" ];	var npcid = [148,154,147,					177,178,199,                     255,253,252,                     405,257,                     512,511,513];	var SupportedNPC=["akara", "elzix", "fara", "drognan", "ormus", "asheara", "anya"];	var SupportedNPCid=[148,177,178,199,255,253,512];	for(var i=0;i<SupportedNPCid.length;i++){		if(npc.classid==SupportedNPCid[i]){			Config.ShopBot.ShopNPC=SupportedNPC[i];			return true;		}	}	say("Supported NPCs:Akara,Elzix,Fara,Drognan,Ormus,Asheara,Anya.");	return false;	}function language(){	switch(getLocaleString(933)){	case "黄金鸟":		return "ch";		break;	case "S金B":		return "tw";		break;	case "The Golden Bird":			return "en";		break;	default:		return "en";		break;	} 	return null;}function showhelp(show){	var i;	if(!show){		for(i=0;i<post.length;i++)		post[i].remove();		return;	}	var readme;	switch(language()){	case "ch":		readme=FileTools.readText("tools/direction-ch.txt");		break;	case "tw":		readme=FileTools.readText("tools/direction-tw.txt");		break;	case "en":			readme=FileTools.readText("tools/direction-en.txt");		break;	}	var readlist=readme.split("\n");	if(language()=="ch" || language()=="tw"){		for(i=0;i<readlist.length && i<36;i++)			post[i]=new Text(readlist[i],20,33+i*13,2);		for(i=36;i<73;i++)			post[i]=new Text(readlist[i],280,46+(i-36)*13,2);		for(i=73;i<readlist.length;i++)			post[i]=new Text(readlist[i],550,46+(i-73)*13,2);					//	if(readlist.length>=30)	//		for(i=36;i<readlist.length;i++)	//			post[i]=new Text(readlist[i],300,46+(i-36)*13,2);										}	if(language()=="en"){		for(i=0;i<readlist.length && i<36;i++)			post[i]=new Text(readlist[i],30,33+i*13,9,0);		if(readlist.length>=30)			for(i=36;i<readlist.length;i++)				post[i]=new Text(readlist[i],380,46+(i-36)*13,9,0);	}}function showmove(show){	var i;	if(!show){		for(i=0;i<post.length;i++)		post[i].remove();		return;	}	if(language()=="ch"){		post[0]=new Text('场景代码列表:(用"-move 数字"去该场景)',30,33,2);	}else	if(language()=="tw"){		post[0]=new Text('鼍按a列表:(用"-move 底"去鼍)',30,33,2);	}else	if(language()=="en"){		post[0]=new Text('areas list:(use"-move number" to move to the area)',30,33,9,0);		}		for(i=1;i<36;i++)			post[i]=new Text(i+"-"+getAreaName(i),30,33+i*13,2);		for(i=36;i<72;i++)			post[i]=new Text(i+"-"+getAreaName(i),200,46+(i-36)*13,2);		for(i=72;i<108;i++)			post[i]=new Text(i+"-"+getAreaName(i),370,46+(i-72)*13,2);		for(i=108;i<136;i++)			post[i]=new Text(i+"-"+getAreaName(i),540,46+(i-108)*13,2);}function showcharinfo(show){	var i;		//if(!show){		for(i=0;i<charinfo.length;i++)		charinfo[i].remove();		if(!show)return;	//}	var resfix=(me.gametype ? 100 : 50);	charinfo[0]=new Text((me.getStat(39)-resfix).toFixed(0),259,406,1);	charinfo[1]=new Text((me.getStat(43)-resfix).toFixed(0),259,431,3);	charinfo[2]=new Text((me.getStat(41)-resfix).toFixed(0),259,456,9);	charinfo[3]=new Text((me.getStat(45)-resfix).toFixed(0),259,479,2);	charinfo[4]=new Text("DR  "+me.getStat(34),200,400);	charinfo[5]=new Text("MDR "+me.getStat(35),200,413);	charinfo[6]=new Text("DR% "+me.getStat(36),200,426);	charinfo[7]=new Text("MR% "+me.getStat(37),200,439);	charinfo[8]=new Text("FHR "+me.getStat(99),100,400);	charinfo[9]=new Text("FBR "+me.getStat(102),100,413);	charinfo[10]=new Text("FCR "+me.getStat(105),100,426);	charinfo[11]=new Text("PLR "+(me.getStat(110)-resfix),100,439);	charinfo[12]=new Text("OW  "+me.getStat(135),100,452);	charinfo[13]=new Text("CB  "+me.getStat(136),100,465);	charinfo[14]=new Text("DS  "+me.getStat(141),100,478);	charinfo[15]=new Text("MF  "+me.getStat(80),100,255);	charinfo[16]=new Text("GF  "+me.getStat(79),100,268);	charinfo[17]=new Text("IAS "+me.getStat(93),164,255);	charinfo[18]=new Text("FRW "+me.getStat(96),164,268);}function prerush(){	Config.HPBuffer = 0;	Config.MPBuffer = 0;	if(!me.gametype){		Config.HPBuffer = 4;		Config.MPBuffer = 10;	}	Town.doChores();	Config.HPBuffer = 20;	Config.MPBuffer = 10;	if(me.diff<2)NTIP.Clear();	if(drivername!=me.name){		say("go.");		delay(1500);	}	if(keycharname=="noname"){		choosekeychar();	}	delay(100);	if(doormaker=="noname"){		choosedoormaker();	}	say("check rush");}function choosekeychar(){	var player, myPartyId;	player = getParty();	if (!player)return false;	var mypartyid;		mypartyid = player.partyid; 	if( mypartyid != 0xFFFF )	{         do 		{           	if( mypartyid == player.partyid && player.name!= me.name)			{				say("-@@keycharname = '"+player.name+"';");				keycharname=player.name;				delay(500);								return true;			}        }while( player.getNext() );	}	return false;}function choosedoormaker(){	var player, myPartyId;	player = getParty();	if (!player)return false;	var mypartyid;		mypartyid = player.partyid; 	if( mypartyid != 0xFFFF )	{         do 		{           	if( mypartyid == player.partyid && player.name!= me.name && player.name != keycharname)			{				say("-@@doormaker = '"+player.name+"';");				doormaker =player.name;				delay(500);				return true;			}        }while( player.getNext() );	}	return false;}function checkrush(){/*任务拆分如下：1。安达利尔2。拿amu3。拿staff4。召唤者5。插杖杀督瑞尔6。崔凡克7。老墨8。chaos*/	var _quest;	if(!me.getQuest(6,0))	_quest=1;	else	if(!me.getQuest(11,0) && !me.getItem(521) && me.act<=2)	_quest=2;	else	if(!me.getQuest(13,0) && !me.getItem(91) && me.act<=2)	_quest=3;	else	if(!me.getQuest(13,0) && me.act<=2)	_quest=4;	else	if(!me.getQuest(14,0) && me.act<=2)	_quest=5;	else	if(!me.getQuest(21,0) && me.act<=3)	_quest=6;	else	if(!me.getQuest(22,0) && me.act<=3)	_quest=7;	else	if(!me.getQuest(26,0) && me.act<=4)	_quest=8;	else	_quest=9;	say("rush@"+_quest);	Town.move("portalspot");}function dokeyin(){	keybusy=true;	var target;	if(me.inTown && leader){		if(!Pather.usePortal(leader.area, drivername)){			Town.move("portalspot");			Pather.usePortal(leader.area, drivername);		}	}	if(!me.inTown)		say("key in "+me.area);	switch(me.area){		case 5://黑暗森林			Pather.moveToPreset(me.area,2,30,2,2);			getQuestItem(524,30);			Pather.usePortal(1, drivername);			Town.move(NPC.Akara);			target = getUnit(1, getLocaleString(2892));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			say("cain scroll ready");					break;		case 4://石块旷野			var _stoneid = [17, 18, 19, 20, 21, 22];        	while(!Pather.getPortal(38))			{	   	 		for(var i = 0; i <6 ; i++)				{					for (var j = 0 ;  j < 5 ;  j++ )					{						var _stone = getUnit(2,_stoneid[j]);						delay(200);						if(_stone.mode>0)continue;						if(me.getSkill(43, 1)>0)						{							Skill.cast(43, 0, _stone);							delay(500);						}						else						{							Pather.moveTo(_stone.x + 2, _stone.y + 2);							sendPacket(1, 0x13, 4, 2, 4, _stone.gid);							//Misc.openChest(_stone);						}									}    			}			}        	Pather.usePortal(1, drivername);			break;		case 38://崔斯特瑞姆			Pather.moveTo(25140, 5139);			var cainbox = getUnit(2, 26);			if(!cainbox)break;			Misc.openChest(cainbox);			var  cainbox = getUnit(2,26,10);			delay(200);			say("bb do cain");			Pather.usePortal(1, drivername);			Town.move(NPC.Akara);			target = getUnit(1, getLocaleString(2892));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move( "portalspot" );			checknextquest();			break;		case 28://军营			Pather.moveToPreset(me.area,2,108,1,1);			getQuestItem(89,108);			Pather.usePortal(1, drivername);			if(me.getItem(89))       			{				say("got malus!");				Town.move(NPC.Charsi); 				target = getUnit(1, getLocaleString(2894));				if (target && target.openMenu()) {					me.cancel();					say("talked "+target.classid);				} 			}			checknextquest();			break;		case 37://地下墓穴四层			Pather.moveTo( 22582, 9612);			break;		case 61://蛇洞第二层			getQuestItem(521, 149);			Pather.usePortal(40, drivername);			Town.move(NPC.Drognan);			target = getUnit(1, getLocaleString(3023));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			if(Storage.Cube.MoveTo(me.getItem(521)))				say("move amu to box ok");			else				say("move amu to box failed");			Town.move("portalspot");			say("amu over");			break;		case 64://虫穴三层			getQuestItem(92, 356);			delay(500);			Pather.usePortal(40, drivername);			if(Storage.Cube.MoveTo(me.getItem("msf")))				say("move staff to box ok");			else				say("move staff to box failed");			Cubing.openCube();			transmute();			delay(750 + me.ping);			Cubing.emptyCube();			me.cancel();			if(me.getItem(91))				say("take out staff ok");			else				say("take out staff failed");			say("staff over");			break;		case 44://失落的城市			if(Town.goToTown())				say("city door open");			break;		case 66:		case 67:		case 68:		case 69:		case 70:		case 71:		case 72://古墓			var staff, item,			orifice = getUnit(2, 152);			if (!orifice)break;			Misc.openChest(orifice);			staff = me.getItem(91);			if (!staff)break;			staff.toCursor();			submitItem();			delay(750 + me.ping);			// unbug cursor			item = me.findItem(-1, 0, 3);			if (item && item.toCursor()) {				Storage.Inventory.MoveTo(item);			}			Pather.usePortal(40,drivername);			delay( 5000 );			say("try tomb");			break;		case 73://督瑞尔的巢穴			Pather.moveTo(22577,15591);			var i,			target = getUnit(1, getLocaleString(1013));			if (!target)break;			for (i = 0; i < 3; i += 1) {				if (getDistance(me, target) > 3) {					Pather.moveToUnit(target);				}				target.interact();				delay(1000 + me.ping);				me.cancel();						if (Pather.getPortal(null)) {					me.cancel();					break;				}			}			say("bb do act2");			Pather.usePortal(null, drivername);					if(palacedoor)			{				Pather.usePortal(50, doormaker);				Pather.moveToExit(40, true);			}			passact(2);			say("keychar ready!");			break;		case 94://残破神殿			getQuestItem(548,193);			Pather.usePortal(75, drivername);			Town.move(NPC.Alkor);			target = getUnit(1, getLocaleString(1010));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			checknextquest();			break;		case 107://火焰之河			if(!me.getItem(551))				try{Pickit.pickItem(getUnit(4, 551));}catch(e){}			var _x,_y;			_x=me.x;			_y=me.y;			var _Hellforge = getUnit(2,376);			try{Pickit.pickItem(getUnit(4, 90));}catch(e){}			Item.equip(me.getItem(90),4);			Packet.dropItem(getUnit(100));			Pather.moveTo(_Hellforge.x+2,_Hellforge.y+2);			Misc.click(0, 0, _Hellforge);			delay( 2000 );			for( var n = 0 ; n < 5 ; n++){       			Misc.click(0, 0, _Hellforge );     			delay( 1500 );			}			delay(3000);			Pather.moveTo(_x,_y);			Pather.usePortal(103, drivername);			break;		case 108://混沌避难所			Pather.moveTo(7774,5264);			Pather.moveTo(7767,5256);			Pather.moveTo(7767,5263);			break;		case 114://冰河			target = getUnit(2, 558);			if (target) {				Pather.moveToUnit(target);				sendPacket(1, 0x13, 4, 0x2, 4, target.gid);				delay(1000 + me.ping);				me.cancel();			}			Pather.usePortal(109, drivername);			Town.move(NPC.Malah);			target = getUnit(1, getLocaleString(22478));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			Pather.usePortal(114, drivername);			delay(500);			target = getUnit(2, 558);			if (target) {				Pather.moveToUnit(target);				sendPacket(1, 0x13, 4, 0x2, 4, target.gid);				delay(1000);				me.cancel();			}			say("bb do anya");			Pather.usePortal(109, drivername);			Town.move(NPC.Malah);			target = getUnit(1, getLocaleString(22478));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			useItem(646);			delay(8000);			checknextquest();			break;	}	keybusy=false;	if(driverwait)say("key free");}function dokeyback(){	var target;	if(me.inTown){		keybusy=false;		return;	}	else{		switch(me.area){				case 17:			dorevive();			say("bb do raven");			Pather.usePortal(1, drivername);			Town.move(NPC.Kashya);			target = getUnit(1, getLocaleString(2893));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			checknextquest();			break;				case 37://地下墓穴第四层       	 	dorevive();			say("bb do act1");			passact(1,true);			break;		case 49://下水道三层       	 	dorevive();			say("bb do skillbook");			if(me.inTown){				Town.move( "portalspot" );				Pather.usePortal(49, drivername);			}			else				try{Pather.moveToUnit(getLeaderUnit(drivername));}catch(e){}			while (true) {				target = getUnit(4, 552);    				if (!target) {					break;				} 				Pickit.pickItem(target);				delay(250); 				if (me.getItem(552)) break;			}			if(!Pather.usePortal(40, drivername))Town.goToTown();			Town.move("atma");			target = getUnit(1, getLocaleString(3024));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			useItem(552);			break;		case 74://神秘避难所			dorevive();			Pather.usePortal(40, drivername);			Town.move("meshif");			target = getUnit(1, getLocaleString(3114));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			say("summer over");			break;		case 83://崔凡克			dorevive();			Town.goToTown();			if(!rushmode || me.diff>=1)say("bb do talkcain");			Town.move("cain");			target = getUnit(1, getLocaleString(2890));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			say("talked cain,ready!");			break;		case 102://憎恨监牢三层       	 	dorevive();			if(me.inTown)Town.move( "portalspot" );			if(!Pather.usePortal(75, drivername))Town.goToTown();			break;		case 105://绝望平原		     dorevive();			 say("bb do angel");			if(!Pather.usePortal(103, drivername))Town.goToTown();			Town.move(NPC.Tyrael);			target = getUnit(1, getLocaleString(1013));			if (target && target.openMenu()) {				me.cancel();				say("talked "+target.classid);			}			Town.move("portalspot");			checknextquest();			break;		case 108://混沌避难所		     dorevive();			 if(!me.gametype)break;			 say("bb do act4");			if(!Pather.usePortal(103, drivername))Town.goToTown();			passact(4);			break;		case 110://血腥丘陵		     dorevive();			if(!Pather.usePortal(109, drivername))Town.goToTown();			say('sock over');			break;		default:		     dorevive();			if(!Pather.usePortal(null, drivername))Town.goToTown();			Town.move( "portalspot" );			break;		}	}}function getQuestItem(classid, chestid){	var chest, item,		tick = getTickCount();	if (me.getItem(classid)) {		return true;	}	if (me.inTown) {		return false;	}	chest = getUnit(2, chestid);	if (!chest) {		return false;	}	Misc.openChest(chest);	delay(800);	item = getUnit(4, classid);	if (!item) {		if (getTickCount() - tick < 500) {			delay(500);		}		return false;	}	if(Pickit.pickItem(item))		return say("pickup "+item.classid) && delay(1000);	else		return say("pickup failed") && delay(1000);}function useItem(classid){	var item=me.findItem(classid, 0, 3);	if(item){		say("use item "+ item.classid + " ok");		clickItem(1, item.x, item.y, 3);		return true;	}	else		say("have no that item");	return false;}function dorevive(){	while (me.mode === 0) {		delay(40);	}	if (me.mode === 17) {		me.revive();		while (!me.inTown) {			delay(40);		}	}}function checknextquest(){			if(questmode && me.name==keycharname)	{		questnum++;		checkquest(questnum);	}}function checkquest(startnum)/*任务列表：1.den2.raven3.cain4.hammer5.blade6.blackbook7.angel8.anya9.skillbook*/{	if(arguments.length < 1)		startnum=1;		var _quest;	var questact;	if(!me.getQuest(1,0) && startnum<=1 && q_den)	{		questnum=1;		questact=1;	}	else	if(!me.getQuest(2,0) && startnum<=2 && q_raven)	{		questnum=2;		questact=1;	}	else	if(!me.getQuest(4,0) && startnum<=3 && q_cain)	{		questnum=3;		questact=1;	}	else	if(!me.getQuest(3,0) && (!me.getQuest(3,1)) && me.getStat(12)>=8 && startnum<=4 && q_hammer)	{		questnum=4;		questact=1;	}	else	if(!me.getQuest(19,0) && (!me.getQuest(19,6)) && startnum<=5 && q_blade)	{		questnum=5;		questact=3;	}	else	if(!me.getQuest(17,0) && startnum<=6 && q_blackbook)	{		questnum=6;		questact=3;	}	else	if(!me.getQuest(25,0) && startnum<=7 && q_angel)	{		questnum=7;		questact=4;	}	else	if(!me.getQuest(37,0) && (!me.getQuest(37,8)) && startnum<=8 && me.gametype && q_anya)	{		questnum=8;		questact=5;	}	else	if(!me.getQuest(9,0) && startnum<=9 && q_skillbook)	{		questnum=9;		questact=2;	}	else	{		questnum=0;		questact=0;	}	if(questact)	{		say("quest@"+questnum);		delay( 800 );		if(me.act!=questact)			say("bb goto act"+questact);		if(Pather.useWaypoint([0,1,40,75,103,109][questact]))			Town.move("portalspot");	}}function dorush(num){	switch(num)	{	case 1:		dorush1();		break;	case 2:		dorush2();		break;	case 3:		dorush3();		break;	case 4:		dorush4();		break;	case 5:		dorush5();		break;	case 6:		dorush6();		break;	case 7:		traover=true;		dorush7();		break;	case 8:		traover=true;		dorush8();		break;	case 9:		break;	}}function dorush1(){	Pather.useWaypoint(35, true);	Precast.doPrecast(true);	if (!Pather.moveToExit([36, 37], true) || !Pather.moveTo(22582, 9612)) {		throw new Error("andy failed");	}	Pather.makePortal();	Attack.securePosition(me.x, me.y, 40, 2000, true);	say("keyin");	putpotion();	while (!playerIn()) {		Pather.moveTo(22582, 9612);		delay(250);	}}function dorush11(){	Pather.moveTo(22564, 9583);	if(me.classid === 1 && me.gametype === 0 && me.diff==2)killAndariel();	else		Attack.kill(156);	say("keyback");	Pather.moveTo(22582, 9612);	Pather.usePortal(null, me.name);	Pather.useWaypoint(44, true);	Pather.makePortal();	driverdooropen=true;	dorush2();}function killAndariel() {	var i,		target = getUnit(1, 156);	if (!target) {		throw new Error("Andariel not found.");	}	for (i = 0; i < 300; i += 1) {		ClassAttack.doCast(target, Config.AttackSkill[1], Config.AttackSkill[2]);		if (target.dead) {			return true;		}		if (getDistance(me, target) <= 10) {			Pather.moveTo(me.x > 22548 ? 22535 : 22560, 9520);		}	}	return target.dead;}	function dorush2(){	if(me.area!=44)	{		Town.move("waypoint");		Pather.useWaypoint(44, true);	}	Precast.doPrecast(true);	putpotion();	//Attack.clear(10,0,false,false,false);	if (!Pather.moveToExit([45, 58, 61], true) || !Pather.moveTo(15044, 14043)) {		throw new Error("amulet failed");	}	//try{Attack.clear(8,0,false,false,false);}catch(e){}	if (getUnit(1, getLocaleString(2935))) {		try{Attack.clearLevel();}catch(e){}	}	pickPotions(20);	if(me.diff==2)		Pickit.pickItems();	Pather.moveTo(15044, 14043,3,false);	if(!driverdooropen){	Pather.makePortal();	say("keyin");	}}function dorush20(){	Pather.makePortal();	driverdooropen=false;	delay(500);	say("keyin");	while (!playerIn())Attack.clear(8,0,false,false,false);}	function dorush21(){	Pather.usePortal(null, me.name);	//if(keydooropen)	try{Pather.usePortal(44,keycharname);}catch(e){}	Pather.useWaypoint(43, true);	dorush3();	}function dorush3(){	if(me.area!=43)	{		Town.move("waypoint");		Pather.useWaypoint(43, true);	}	Precast.doPrecast(true);	putpotion();	if (!Pather.moveToExit([62, 63, 64], true) || !Pather.moveToPreset(me.area, 2, 356)) {		throw new Error("staff failed");	}	Pather.makePortal();		Attack.securePosition(me.x, me.y, 30, 2000, true);	say("keyin");	Misc.openChest(getUnit(2, 356));	pickPotions(20);	Pather.moveToPreset(me.area, 2, 356);	Attack.securePosition(me.x, me.y, 30, 2000, true);}	function dorush31(){	Pather.usePortal(null, me.name);		delay(200);	//if(keydooropen)	try{Pather.usePortal(44,keycharname);}catch(e){}	Pather.useWaypoint(74, true);	dorush4();	}function dorush4(){	if(me.area!=74)	{		Town.move("waypoint");		Pather.useWaypoint(74, true);	}	Precast.doPrecast(true);	putpotion();	var i,		preset = getPresetUnit(me.area, 2, 357),		spot = {};	switch (preset.roomx * 5 + preset.x) {	case 25011:		spot = {x: 25081, y: 5446};		break;	case 25866:		spot = {x: 25830, y: 5447};		break;	case 25431:		switch (preset.roomy * 5 + preset.y) {		case 5011:			spot = {x: 25449, y: 5081};			break;		case 5861:			spot = {x: 25447, y: 5822};			break;		}		break;	}	if (!Pather.moveToUnit(spot)) {		throw new Error("summoner failed");	}	Pather.makePortal();	Attack.securePosition(me.x, me.y, 25, 2000);	say("keyin");	while (!playerIn()) {		Pather.moveToUnit(spot);		Attack.securePosition(me.x, me.y, 25, 500);		delay(250);	}}	function dorush41(){	Pather.moveToPreset(me.area, 2, 357);	Attack.kill(250);	say("keyback");	pickPotions(20);	if(me.diff==2)Pickit.pickItems();	Pather.moveToPreset(me.area, 2, 357);	var journal = getUnit(2, 357);	for (var i = 0; i < 5; i += 1) {		journal.interact();		delay(1000);		me.cancel();		if (Pather.getPortal(46)) {			break;		}	}	if (i === 5) {		throw new Error("summoner failed");	}	Pather.usePortal(46);	dorush5();}function dorush5(){	if(me.area!=46)	{		Town.move("waypoint");		Pather.useWaypoint(46, true);	}	Precast.doPrecast(true);	putpotion();	if (!Pather.moveToExit(getRoom().correcttomb, true) || !Pather.moveToPreset(me.area, 2, 152)) {		throw new Error("duriel failed");	}	Pather.makePortal();	Attack.securePosition(me.x, me.y, 30, 2000, true, me.diff === 2);	pickPotions(20);	if(me.diff==2)Pickit.pickItems();	say("keyin");	putpotion();	Pather.moveToPreset(me.area, 2, 152);	while (!playerIn()) {		Attack.securePosition(me.x, me.y, 25, 500);		delay(250);	}	for(var i=0;i<10;i++)	{		Attack.clear(10,0,false,false,false);		delay(1000);		if(me.area==73)break;	}		}function dorush51(){	Pather.moveToPreset(me.area, 2, 152);	while (!getUnit(2, 100)) {		delay(500);	}	Pather.useUnit(2, 100, 73);	Attack.kill(211);	if(me.diff==2)		Pickit.pickItems();	Pather.moveTo(22630,15710);	Pather.moveTo(22611,15707);	Pather.walkTo(22607,15707);	Pather.moveTo(22580,15707);	Pather.moveTo(22579,15667);	Pather.moveTo(22579,15633);	Pather.moveTo(22577,15593);	Pather.makePortal();	while(1)	{		if(getroomcount(40)+1==getpartycount())break;		delay(1000);	}	say("keyin");	/*while (!playerIn()) {		delay(100);	}*/	if (!Pather.usePortal(null, me.name)) {		Town.goToTown();	}	delay(200);	//if(keydooropen)	try{Pather.usePortal(44,keycharname);}catch(e){}		if(me.diff==0 || me.gametype)	{		Pather.useWaypoint(107, true);			dorushclearchaos();	}	else	{		Pather.useWaypoint(83, true);		dorush6();	}}function dorushclearchaos(prerushmode){	this.getLayout = function (seal, value) {		var sealPreset = getPresetUnit(108, 2, seal);		if (!seal) {			throw new Error("Seal preset not found. Can't continue.");		}		if (sealPreset.roomy * 5 + sealPreset.y === value || sealPreset.roomx * 5 + sealPreset.x === value) {			return 1;		}		return 2;	};	this.initLayout = function () {		this.vizLayout = this.getLayout(396, 5275);		this.seisLayout = this.getLayout(394, 7773);		this.infLayout = this.getLayout(392, 7893);	};	this.getBoss = function (name) {		var i, boss,			glow = getUnit(2, 131);		for (i = 0; i < (name === getLocaleString(2853) ? 14 : 12); i += 1) {			boss = getUnit(1, name);			if (boss) {				if (name === getLocaleString(2852)) {					this.chaosPreattack(getLocaleString(2852), 8);				}				Attack.kill(name);				Pickit.pickItems();				return true;			}			delay(250);		}		return !!glow;	};	this.chaosPreattack = function (name, amount) {		var i, n, target, positions;		switch (me.classid) {		case 0:			break;		case 1:			break;		case 2:			break;		case 3:			target = getUnit(1, name);			if (!target) {				return;			}			positions = [[6, 11], [0, 8], [8, -1], [-9, 2], [0, -11], [8, -8]];			for (i = 0; i < positions.length; i += 1) {				if (Attack.validSpot(target.x + positions[i][0], target.y + positions[i][1])) { // check if we can move there					Pather.moveTo(target.x + positions[i][0], target.y + positions[i][1]);					Skill.setSkill(Config.AttackSkill[2], 0);					for (n = 0; n < amount; n += 1) {						Skill.cast(Config.AttackSkill[1], 1);					}					break;				}			}			break;		case 4:			break;		case 5:			break;		case 6:			break;		}	};	this.openSeal = function (id) {		Pather.moveToPreset(108, 2, id, 4);		var i, tick,			seal = getUnit(2, id);		if (seal) {			for (i = 0; i < 3; i += 1) {				seal.interact();				tick = getTickCount();				while (getTickCount() - tick < 500) {					if (seal.mode) {						return true;					}					delay(10);				}			}		}		return false;	};	if( arguments.length < 1 )		prerushmode=false;	if(me.area!=107 && me.area!=108){		Pather.useWaypoint(107, true);	}	Precast.doPrecast(true);	putpotion();	var killleft=false;	var killright=false;	var killup=false;	Pather.moveTo(7790, 5544);	this.initLayout();	if (!this.openSeal(395) || !this.openSeal(396)) {		throw new Error("Failed to open seals");	}	if (this.vizLayout === 1) {		Pather.moveTo(7691, 5292);	} else {		Pather.moveTo(7695, 5316);	}	if (this.getBoss(getLocaleString(2851)))killleft=true;	if (!this.openSeal(392) || !this.openSeal(393)) {		throw new Error("Failed to open seals");	}	if (this.infLayout === 1) {		delay(1);	} else {		Pather.moveTo(7928, 5295); // temp	}	if(this.getBoss(getLocaleString(2853)))killright=true;	if (!this.openSeal(394)) {		throw new Error("Failed to open seals");	}	if (this.seisLayout === 1) {		Pather.moveTo(7771, 5196);	} else {		Pather.moveTo(7798, 5186);	}	if (this.getBoss(getLocaleString(2852)))killup=true;	Attack.clear(15,0,false,false,false);	if(killleft&&killright&&killup)clearchaos=true;	pickPotions(20);	if(!traover)	{		Town.goToTown();		putpotion();		Town.move("waypoint");		if(prerushmode)		{			return;		}		Pather.useWaypoint(83, true);		dorush6();	}	return;}function dorush6(){	if(me.area!=83){		Town.move("waypoint");		Pather.useWaypoint(83, true);	}	Precast.doPrecast(true);	putpotion();	while(1)	{		if(getroomcount(75)+1==getpartycount())break;		delay(1000);	}			coords = [me.x, me.y];	Pather.moveTo(coords[0] + 23, coords[1] - 102);	Pather.makePortal();	Attack.securePosition(me.x, me.y, 40, 2000);	say("keyin");	Pather.moveTo(coords[0] + 23, coords[1] - 102);}function dorush61(){	Pather.moveTo(coords[0] + 30, coords[1] - 134);	Pather.moveTo(coords[0] + 86, coords[1] - 130);	Pather.moveTo(coords[0] + 71, coords[1] - 94);	Attack.securePosition(me.x, me.y, 40, 2000);	pickPotions(20);	say("keyback");	if(me.diff==2)Pickit.pickItems();	if(!me.getItem(549)){		try{Pickit.pickItem(getUnit(4, 549));}catch(e){}	}	traover=true;	Town.goToTown();	if(me.diff==0)	say("box");	delay(500);	dorush7();}function dorush7()//mephisto{	Town.move("waypoint");	Pather.useWaypoint(101, true);	Precast.doPrecast(true);	putpotion();	Pather.moveToExit(102, true);	Pather.makePortal();	while(1)	{		if(getroomcount(75)+1==getpartycount())break;		delay(1000);	}	delay(500);	say("keyin");}function dorush71(){	if(me.diff<2 || me.gametype)	{		Pather.moveTo(17591, 8070);		Attack.clear(20,0,false,false,false);	}			Pather.moveTo(17591, 8070);	Attack.kill(242);	say("keyback");	if(me.diff==2)Pickit.pickItems();	if(q_stone)try{Pickit.pickItem(getUnit(4, 551));}catch(e){}	Pather.moveTo(17602,8069);	Pather.makePortal();		var hydra = getUnit(1, getLocaleString(3325));	if (hydra) {		do {			while (hydra.mode !== 0 && hydra.mode !== 12 && hydra.hp > 0) {				Attack.clear(25,0,false,false,false);				delay(500);			}		} while (hydra.getNext());	}	Pather.moveTo(17602,8069);	while(1)	{		if(getroomcount(75)+1==getpartycount())break;		delay(1000);		Attack.clear(25);	}	say("pass3");	Pather.usePortal(null, me.name);	if(q_stone)dostone();	else	{		Town.move("waypoint");		Pather.useWaypoint(107, true);		//if(me.diff==0 || me.gametype || !handchaos)			dorush8();		//else		//	Print('time to chaos,hold your mouse!');	}}		function dorush8()//chaos{	if(me.area!=107 && me.area!=108)	{		//Town.move("waypoint");		Pather.useWaypoint(107, true);	}	Precast.doPrecast(true);	putpotion();	Pather.moveTo(7789,5340);	while(me.y>5368)delay(1000);	if(!clearchaos && !getUnit(1, 243))		dorushclearchaos();		while(1)	{		if(getroomcount(103)+1==getpartycount())break;		Attack.clear(10);		delay(1000);	}		Pather.moveTo(7767,5256);	Pather.makePortal();	Pather.moveTo(7767,5231);	say("keyin");	}function dorush81(){ 	Pather.moveTo(7789, 5281);	while (!getUnit(1, 243)) {		delay(500);	}	Attack.kill(243);	say("keyback");	if(me.diff==2)Pickit.pickItems();	pickPotions(20);	if(me.gametype)	{		Pather.moveTo(7767,5256);		Pather.usePortal(null, me.name);		if(me.diff<2)		{			Town.move("waypoint");			Pather.useWaypoint(111, true);			dorushsock();		}	}	else{		say("rush over");	}}		function dorushsock()//打孔{	if(me.area!=111)	{		Town.move("waypoint");		Pather.useWaypoint(111, true);	}	Precast.doPrecast(true);	putpotion();	Pather.moveTo(3847, 5100);	Attack.clear(20);	Pather.moveTo(3847, 5100);	Pather.makePortal();	delay(500);	while(1)	{		if(getroomcount(109)+1==getpartycount())break;		Attack.clear(20);		delay(1000);	}	delay(2000);		say("keyin");	while (!playerIn()) {		Attack.clear(20);		delay(100);	}	dorushsock1();}function dorushsock1(){	Pather.moveTo(3888, 5114);	Attack.kill(getLocaleString(22435));	say("keyback");	Pather.moveTo(3847, 5100);	Pather.usePortal(null, me.name);	//Town.move("waypoint");	//Pather.useWaypoint(118, true);	if(me.diff==1)		dorush3bar();	if(me.diff==0)		dorushbaal();}function dorush3bar(){	if(me.area!=118)	{		Town.move("waypoint");		Pather.useWaypoint(118, true);	}	Precast.doPrecast(true);	putpotion();	if (!Pather.moveToExit(120, true)) {		throw new Error("Failed to go to Ancients way.");	}	Pather.makePortal();	delay(500);	say("1");	while(1)	{		if(getroomcount(120)>=1)break;		delay(1000);	}	Pather.moveTo(10048, 12628);	var altar = getUnit(2, 546);	if (altar) {		while (altar.mode !== 2) {			Pather.moveToUnit(altar);			altar.interact();			delay(2000 + me.ping);			me.cancel();		}	}	while (!getUnit(1, 542)) {		delay(250);	}	Attack.clear(50);	Pather.moveTo(10058, 12667);	me.cancel();	Town.goToTown();	say("2");	dorushbaal();}function dorushbaal(){	var tick, portal;	this.preattack = function () {		var check;		switch (me.classid) {		case 1:			if ([56, 59, 64].indexOf(Config.AttackSkill[1]) > -1) {				if (me.getState(121)) {					delay(500);				} else {					Skill.cast(Config.AttackSkill[1], 0, 15093, 5024);				}			}			return true;		case 3: // Paladin			if (Config.AttackSkill[3] !== 112) {				return false;			}			if (getDistance(me, 15093, 5029) > 3) {				Pather.moveTo(15093, 5029);			}			if (Config.AttackSkill[4] > 0) {				Skill.setSkill(Config.AttackSkill[4], 0);			}			Skill.cast(Config.AttackSkill[3], 1);			return true;		case 5: // Druid			if (Config.AttackSkill[3] === 245) {				Skill.cast(Config.AttackSkill[3], 0, 15093, 5029);				return true;			}			break;		case 6:			if (Config.UseTraps) {				check = ClassAttack.checkTraps({x: 15093, y: 5029});				if (check) {					ClassAttack.placeTraps({x: 15093, y: 5029}, 5);					return true;				}			}			break;		}		return false;	};	this.checkThrone = function () {		var monster = getUnit(1);		if (monster) {			do {				if (Attack.checkMonster(monster) && monster.y < 5080) {					switch (monster.classid) {					case 23:					case 62:						return 1;					case 105:					case 381:						return 2;					case 557:						return 3;					case 558:						return 4;					case 571:						return 5;					default:						Attack.getIntoPosition(monster, 10, 0x4);						Attack.clear(15);						return false;					}				}			} while (monster.getNext());		}		return false;	};	this.clearThrone = function () {		var i, monster,			monList = [],			pos = [15097, 5054, 15085, 5053, 15085, 5040, 15098, 5040, 15099, 5022, 15086, 5024];		if (Config.AvoidDolls) {			monster = getUnit(1, 691);			if (monster) {				do {					if (monster.x >= 15072 && monster.x <= 15118 && monster.y >= 5002 && monster.y <= 5079 && Attack.checkMonster(monster) && Attack.skipCheck(monster)) {						monList.push(copyUnit(monster));					}				} while (monster.getNext());			}			if (monList.length) {				Attack.clearList(monList);			}		}		for (i = 0; i < pos.length; i += 2) {			Pather.moveTo(pos[i], pos[i + 1]);			Attack.clear(30);		}	};	this.checkHydra = function () {		var monster = getUnit(1, "hydra");		if (monster) {			do {				if (monster.mode !== 12 && monster.getStat(172) !== 2) {					Pather.moveTo(15118, 5002);					while (monster.mode !== 12) {						delay(500);						if (!copyUnit(monster).x) {							break;						}					}					break;				}			} while (monster.getNext());		}		return true;	};	if (me.inTown) {		//Town.doChores();		Pather.useWaypoint(129, true);		Precast.doPrecast(true);		if (!Pather.moveToExit([130, 131], true)) {			throw new Error("Failed to move to Throne of Destruction.");		}	}	Pather.moveTo(15113, 5040);	Attack.clear(15);	this.clearThrone();	tick = getTickCount();	Pather.moveTo(15093, me.classid === 3 ? 5029 : 5039);MainLoop:	while (true) {		if (getDistance(me, 15093, me.classid === 3 ? 5029 : 5039) > 3) {			Pather.moveTo(15093, me.classid === 3 ? 5029 : 5039);		}		if (!getUnit(1, 543)) {			break MainLoop;		}		switch (this.checkThrone()) {		case 1:			Attack.clear(40);			tick = getTickCount();			Precast.doPrecast(true);			break;		case 2:			Attack.clear(40);			tick = getTickCount();			break;		case 4:			Attack.clear(40);			tick = getTickCount();			break;		case 3:			Attack.clear(40);			this.checkHydra();			tick = getTickCount();			break;		case 5:			Attack.clear(40);			break MainLoop;		default:			if (getTickCount() - tick < 7e3) {				if (me.getState(2)) {					Skill.setSkill(109, 0);				}				break;			}			if (!this.preattack()) {				delay(100);			}			break;		}		Precast.doPrecast(false);		delay(10);	}	this.clearThrone();	Pather.moveTo(15092, 5011);	Precast.doPrecast(true);	while (getUnit(1, 543)) {		delay(500);	}	delay(1000);	portal = getUnit(2, 563);	if (portal) {		Pather.usePortal(null, null, portal);	} else {		throw new Error("Couldn't find portal.");	}	Pather.moveTo(15213, 5908);	Pather.makePortal();	Pather.moveTo(15177,5953);	say("bumperin");}function dorushbaal1(){	Pather.moveTo(15134, 5923);	Attack.kill(544); // Baal	Pickit.pickItems();	say("rush over");}function waitkeyin(range){	if(arguments.length < 1)		range=10;		while(1)	{		if(getroomcount()>=1)return true;		Attack.clear(range);		delay( 1000 );	}}function waitkeyback(range){	if(arguments.length < 1)		range=10;		while(1)	{		if(getroomcount()==0)return true;		Attack.clear(range);		delay( 1000 );	}}function playerIn(area) {	if (!area)area = me.area;	var party = getParty();	if (party) {		do {			if (party.name !== me.name && party.area === area) {				return true;			}		} while (party.getNext());	}	return false;}function getpartycount(){	var count=0;	var mypartyid;	var player = getParty(); 	mypartyid = player.partyid; 	if( mypartyid != 0xFFFF )		{ 			do 			{ 				if( mypartyid == player.partyid ){count++;}					}while( player.getNext() );		}	delay( 100 );	return count;}function getroomcount(_areaid){	if(arguments.length < 1)		_areaid=me.area;	var count=0;	var mypartyid;	var player = getParty(); 	mypartyid = player.partyid; 	if( mypartyid != 0xFFFF )	{ 		do{ 			if( mypartyid == player.partyid && player.area==_areaid ){count++;}		}while( player.getNext() );	}	delay( 100 );	return count;}function myrank(){	var i,rank=[];	var player = getParty(); 	do{ 		rank.push(player.level);	}while( player.getNext() );		rank.sort(function(a,b){return a<b?1:-1});	for(i=0;i<rank.length;i++){		if(me.getStat(12)==rank[i])			return i+1;	}	return 0;}function fullbelt(){	var _beltSize,col;	var i;	_beltSize = Storage.BeltSize();	col = Town.checkColumns(_beltSize);	for(i=0;i<4;i++){		if(Config.BeltColumn[i]=="rv")			col[i]=0;	}	if(eval(col.join('+'))==0){		return true;	}	return false;}function doquest(num){	switch(num)	{	case 1:		doden();		break;	case 2:		doraven();		break;	case 3:		docain();		break;	case 4:		dohammer();		break;	case 5:		doblade();		break;	case 6:		doblackbook();		break;	case 7:		doangel();		break;	case 8:		doanya();		break;	case 9:		doskillbook();		break;	}}function waitbb(_areaid){	if(arguments.length < 1)		_areaid=me.area;	while(1)	{		if(getroomcount(_areaid)+1>=getpartycount())return true;		Attack.clear(10);		delay( 1000 );	}	return false;}function doden(){	if(me.getQuest(1,0))	{		say("can't do quest den.");		say("check next quest");		return;		}	Town.move("waypoint");	Pather.useWaypoint(3,true);	Precast.doPrecast(true);	putpotion();	Pather.moveToExit([2, 8], true);	waitbb(1);	Attack.clearLevel();	say("bb do den");	Town.goToTown();	//Town.move("waypoint");}function doraven(){	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(3);	Precast.doPrecast(true);	putpotion();	Pather.moveToExit([17, 19],false);	Pather.makePortal();	Attack.clear(10);	say("keyin");	waitkeyin();	Pather.moveToPreset(17, 1, 805);	Attack.kill(getLocaleString(3111));	say("keyback");	waitkeyback();	if(me.diff==2)Pickit.pickItems();	Pather.moveToExit([17, 19],false);	Pather.usePortal(null, me.name);	//Town.move("waypoint");}	function docain(){	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(5);	Precast.doPrecast(true);	putpotion();	Pather.moveToPreset(5,2,30,2,2);	Pather.makePortal();	Attack.clear(20);		say("keyin");	Pather.moveToPreset(5,2,30,2,2);	waitkeyin();	waitkeyback();	Pather.moveToPreset(5,2,30,2,2);	Pather.usePortal(null, me.name);	Town.move("waypoint");	Pather.useWaypoint(4);	Precast.doPrecast(true);	putpotion();	Pather.moveToPreset(4,2,17,7,7);	Pather.makePortal();	Attack.clear(20);	say("keyin");	Pather.moveToPreset(4,2,17,7,7);	waitkeyin();	waitkeyback();	var i,portal;	for (i = 0; i < 6; i += 1) {		portal = Pather.getPortal(38);		if (portal) {			Pather.usePortal(null, null, portal);			break;		}		delay(500);	}		//Pather.usePortal(38);	waitbb(1);	Pather.moveTo( 25136, 5137);	Pather.makePortal();	Attack.clear(20);	Pather.moveTo( 25136, 5137); 	say("keyin");	waitkeyin();	waitkeyback();	Pather.moveTo( 25136, 5137);	Pather.usePortal(null, me.name);	//Town.move("waypoint");  }function dohammer(){	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(27);	Precast.doPrecast(true);	putpotion();	Pather.moveToPreset(28,2,108,5,5);	Pather.makePortal();	Attack.clear(20);	Pather.moveToPreset(28,2,108,5,5);	waitbb(1);	say("keyin");	waitkeyin();	waitkeyback();	Pather.moveToPreset(28,2,108,5,5);	Pather.usePortal(null, me.name);	//Town.move("waypoint");  }function doskillbook(){	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(48);	Precast.doPrecast(true);	putpotion();	Pather.moveToExit(49, true);	waitbb(40);	moveunit(355);	Pather.makePortal();	Attack.clear(20);	say("keyin");	waitkeyin();	Pather.moveToPreset(me.area, 2, 355);	Attack.kill(229); 	Pickit.pickItems();	Attack.openChests(20);		Attack.clear(20);	Pather.makePortal();	say("keyback");	Pather.moveTo( me.x+7, me.y+7);	waitbb(40);	Pather.moveTo( me.x-7, me.y-7);	Pather.usePortal(null, me.name);	//Town.move("waypoint");}function moveunit(unitid){	var i, n;	var _unit;	var path;	_unit = getPresetUnit(me.area, 2,unitid);	if(!_unit)return false;	path = getPath(me.area, me.x, me.y, _unit.roomx*5+_unit.x, _unit.roomy*5+_unit.y, 1, 40);	return Pather.moveTo(path[path.length-3].x,path[path.length-3].y);}function doblade(){	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(78);	Precast.doPrecast(true);	putpotion();	Pather.moveToPreset(me.area,2,252,3,3);	var _torch = getUnit(2,252);	/*if(me.diff<=2)	{			Attack.clear(20);		Pather.moveToPreset(me.area,2,252,3,3);	}*/	Misc.openChest(_torch);	for(var i = 0 ; i < 30 ; i++)		{		if(getUnit(1, 407))		{			if(Attack.kill(407))				break;		}		Attack.clear(20);		Pather.moveToPreset(me.area,2,252,3,3);		delay(1000);			}	delay(500);	Pickit.pickItem(getUnit(4, 87));	Town.goToTown();	if(Packet.dropItem(me.getItem(87)))	{		Pather.useWaypoint(103);		waitbb(75);		say("key do blade");		//Town.move("waypoint");	}	else	{		//Town.move("waypoint");		say('check next quest');	}	}function doblackbook(){	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(80);	waitbb(75);	Precast.doPrecast(true);	putpotion();	Pather.moveToExit(94, true);	Pather.moveToPreset(me.area, 2, 193);	Pather.makePortal();	Attack.clear(20);	Pather.moveToPreset(me.area, 2, 193);	say("keyin");	waitkeyin();	if(me.diff==2)Pickit.pickItems();	waitkeyback();	Pather.usePortal(null, me.name);	//Town.move("waypoint");}function doangel(){	var _x;	var _y;	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(106);	waitbb(103);	Precast.doPrecast(true);	putpotion();	Pather.moveToPreset(105, 1, 256, 40, 40);	_x=me.x;	_y=me.y;	Pather.makePortal();	Attack.clear(15);	say("keyin");	waitkeyin();	Attack.kill(256);	say("keyback");	if(me.diff==2)Pickit.pickItems();	Pather.moveTo(_x,_y);	waitkeyback();	Pather.usePortal(null, me.name);	//Town.move("waypoint");}function dostone(){	var _x;	var _y;	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(107);	Precast.doPrecast(true);	putpotion();	Pather.moveToPreset(107,2,376,5,5);	Attack.kill(409);	_x=me.x;	_y=me.y;	Pather.makePortal();	waitbb(103);	try{Packet.dropItem(me.getItem(551));}catch(e){}	Attack.clear(40);	Pather.moveToPreset(107,2,376,5,5);	Attack.clear(40);	say("keyin");	waitkeyin();	waitkeyback();	Config.Cubing = true;	Config.Recipes.push([Recipe.Gem, "Flawless Amethyst"]); // Make Perfect Amethyst	Config.Recipes.push([Recipe.Gem, "Flawless Topaz"]); // Make Perfect Topaz	Config.Recipes.push([Recipe.Gem, "Flawless Sapphire"]); // Make Perfect Sapphire	Config.Recipes.push([Recipe.Gem, "Flawless Emerald"]); // Make Perfect Emerald	Config.Recipes.push([Recipe.Gem, "Flawless Ruby"]); // Make Perfect Ruby	Config.Recipes.push([Recipe.Gem, "Flawless Diamond"]); // Make Perfect Diamond	Config.Recipes.push([Recipe.Gem, "Flawless Skull"]); // Make Perfect Skull	Pickit.pickItems();	NTM_MoveTo(107,_x,_y);	Pather.usePortal(null, me.name);	Config.HPBuffer = 0;	Config.MPBuffer = 0;	Town.doChores();	Config.HPBuffer = 20;	Config.MPBuffer = 10;			dorush(8);}function doanya(){	Town.goToTown();	Town.move("waypoint");	Pather.useWaypoint(113);	Precast.doPrecast(true);	putpotion();	Pather.moveToExit(114, true);	Pather.moveToPreset(me.area, 2, 460);	Attack.securePosition(me.x, me.y, 30, 2000);		Pather.moveToPreset(me.area, 2, 460);	Pather.makePortal();	waitbb(109);	say("keyin");	waitkeyin();	waitkeyback();	waitkeyin();	waitkeyback();	Pather.moveToPreset(me.area, 2, 460);	Pather.usePortal(null, me.name);	//Town.move("waypoint");}function savegameinfo(mode,keeptime)//mode:0-不用做什么，1-自动建游戏，2-自动加入游戏,3-diablo leech,4-baal leech,keeptime:多长时间有效，单位秒{	if( arguments.length < 2 )		keeptime=60;//默认1分钟	var _gameinfo="";	var _time=0;	if(mode && mode>0)		_time=getTickCount()+keeptime*1000;	_gameinfo+="lastgamename="+"'"+cgamename+"';"+"\n";	_gameinfo+="lastgamepass="+"'"+cgamepassword+"';"+"\n";	_gameinfo+="lastdiff="+me.diff+";"+"\n";	_gameinfo+="lasttime="+_time+";"+"\n";	switch(mode)	{		case 0:			_gameinfo+="autocreate=false;"+"\n";			_gameinfo+="autojoin=false;"+"\n";			break;		case 1:			_gameinfo+="autocreate=true;"+"\n";			_gameinfo+="autojoin=false;"+"\n";			break;		case 2:			_gameinfo+="autocreate=false;"+"\n";			_gameinfo+="autojoin=true;"+"\n";			break;		case 3:			_gameinfo+="autocreate=false;"+"\n";			_gameinfo+="autojoin=true;"+"\n";			_gameinfo+="diablomode=true;"+"\n";			break;		case 4:			_gameinfo+="autocreate=false;"+"\n";			_gameinfo+="autojoin=true;"+"\n";			_gameinfo+="baalmode=true;"+"\n";			break;	}		FileTools.writeText("tools/maplog/profile-"+me.profile+".txt",_gameinfo);}function UnitInfo() {	this.x = 200;	this.y = 250;	this.hooks0 = [];	this.cleared = true;	this.createInfo = function (unit) {		if (typeof unit === "undefined") {			this.remove();			return;		}		switch (unit.type) {		case 0:			this.playerInfo(unit);			break;		case 1:			this.monsterInfo(unit);			break;		case 4:			this.itemInfo(unit);			break;		}	};	this.playerInfo = function (unit) {		var i, items, string,			frameXsize = 0,			frameYsize = 20,			quality = ["c0", "c0", "c0", "c0", "c3", "c2", "c9", "c4", "c8"];		if (!this.currentGid) {			this.currentGid = unit.gid;		}		if (this.currentGid === unit.gid && !this.cleared) {			return;		}		if (this.currentGid !== unit.gid) {			this.remove();			this.currentGid = unit.gid;		}		this.hooks0.push(new Text("Classid: c0" + unit.classid, this.x, this.y, 4, 13, 2));		items = unit.getItems();		if (items) {			this.hooks0.push(new Text("Equipped items:", this.x, this.y + 15, 4, 13, 2));			frameYsize += 15;			for (i = 0; i < items.length; i += 1) {				if (items[i].getFlag(0x4000000)) {					string = items[i].fname.split("\n")[1] + "c0 " + items[i].fname.split("\n")[0];				} else {					string = quality[items[i].quality] + (items[i].quality > 4 && items[i].getFlag(0x10) ? items[i].fname.split("\n").reverse()[0].replace("c4", "") : items[i].name);				}				this.hooks0.push(new Text(string, this.x, this.y + (i + 2) * 15, 0, 13, 2));				if (string.length > frameXsize) {					frameXsize = string.length;				}				frameYsize += 15;			}		}		this.cleared = false;		this.hooks0.push(new Box(this.x + 2, this.y - 15, Math.round(frameXsize * 7.5) - 4, frameYsize, 0x0, 1, 2));		this.hooks0.push(new Frame(this.x, this.y - 15, Math.round(frameXsize * 7.5), frameYsize, 2));		this.hooks0[this.hooks0.length - 2].zorder = 0;	};	this.monsterInfo = function (unit) {		var frameYsize = 140;		if (!this.currentGid) {			this.currentGid = unit.gid;		}		if (this.currentGid === unit.gid && !this.cleared) {			return;		}		if (this.currentGid !== unit.gid) {			this.remove();			this.currentGid = unit.gid;		}		this.hooks0.push(new Text("Classid: c0" + unit.classid, this.x, this.y, 4, 13, 2));		this.hooks0.push(new Text("HP % : c0" + Math.round(unit.hp * 100 / 128), this.x, this.y + 15, 4, 13, 2));		this.hooks0.push(new Text("Level: c2" + unit.getStat(12), this.x, this.y + 30, 4, 13, 2));		this.hooks0.push(new Text("FR: c1" + unit.getStat(39), this.x, this.y + 45, 4, 13, 2));		this.hooks0.push(new Text("CR: c3" + unit.getStat(43), this.x, this.y + 60, 4, 13, 2));		this.hooks0.push(new Text("LR: c9" + unit.getStat(41), this.x, this.y + 75, 4, 13, 2));		this.hooks0.push(new Text("PR: c2" + unit.getStat(45), this.x, this.y + 90, 4, 13, 2));		this.hooks0.push(new Text("DR: c7" + unit.getStat(36), this.x, this.y + 105, 4, 13, 2));		this.hooks0.push(new Text("MR: c8" + unit.getStat(37), this.x, this.y + 120, 4, 13, 2));		this.cleared = false;		this.hooks0.push(new Box(this.x + 2, this.y - 15, 136, frameYsize, 0x0, 1, 2));		this.hooks0.push(new Frame(this.x, this.y - 15, 140, frameYsize, 2));		this.hooks0[this.hooks0.length - 2].zorder = 0;	};	this.itemInfo = function (unit) {		var i = 0,			frameYsize = 65;		if (!this.currentGid) {			this.currentGid = unit.gid;		}		if (this.currentGid === unit.gid && !this.cleared) {			return;		}		if (this.currentGid !== unit.gid) {			this.remove();			this.currentGid = unit.gid;		}		this.hooks0.push(new Text("Classid: c0" + unit.classid, this.x-4, this.y, 4, 13, 2));		this.hooks0.push(new Text("Code: c0" + unit.code, this.x-11, this.y + 15, 4, 13, 2));		this.hooks0.push(new Text("Item level: c0" + unit.ilvl, this.x+5, this.y + 30, 4, 13, 2));		this.hooks0.push(new Text("Sell value: c0" + unit.getItemCost(1), this.x+10, this.y + 45, 4, 13, 2));		this.cleared = false;		this.socketedItems = unit.getItems();		if (this.socketedItems) {			this.hooks0.push(new Text("Socket[c0"+unit.getStat(194)+"c4]:", this.x+3, this.y + 60, 4, 13, 2));			frameYsize += 15;			for (i = 0; i < this.socketedItems.length; i += 1) {				this.hooks0.push(new Text(this.socketedItems[i].fname.split("\n").reverse().join(" "), this.x, this.y + (i + 5) * 15, 0, 13, 2));				frameYsize += 15;			}		}		if (unit.quality === 4 && unit.getFlag(0x10)) {			this.hooks0.push(new Text("Prefix: c0" + unit.prefixnum, this.x, this.y + frameYsize - 5, 4, 13, 2));			this.hooks0.push(new Text("Suffix: c0" + unit.suffixnum, this.x, this.y + frameYsize + 10, 4, 13, 2));			frameYsize += 30;		}		this.hooks0.push(new Box(this.x + 2, this.y - 15, 116, frameYsize, 0x0, 1, 2));		this.hooks0.push(new Frame(this.x, this.y - 15, 120, frameYsize, 2));		this.hooks0[this.hooks0.length - 2].zorder = 0;	};	this.remove = function () {		while (this.hooks0.length > 0) {			this.hooks0.shift().remove();		}		this.cleared = true;	};}function checkhighestchar() {	var highplayer, _player,highlevel=0;	_player = getParty(); // get party object (players in game)	do {		if (_player.name !=me.name && _player.level >= highlevel) { 			highplayer = _player.name;			highlevel = _player.level;		}	} while (_player.getNext());	if(highlevel>0)		return highplayer;	else return null;}function dodiabloleech(){	diablomode=true;	Config.HPBuffer = 0;	Config.MPBuffer = 0;	cgamename=calclastgamename(me.gamename);	savegameinfo(3,200);	//var leader;	//while(me.partyid=== 0xFFFF )delay(1000);	leader=checkhighestchar();	if(!leader)return false;	Config.Leader=leader;	pri("diablo leech start!the leader is "+leader);	diabloleader=getParty(leader);	//var orderline=FileTools.readText("libs/bots/Wakka.js");	//eval(orderline+"\n"+"Wakka"+"();");	Wakka();	Config.HPBuffer = 20;	Config.MPBuffer = 10;	cgamename=me.gamename;	savegameinfo(3);	while (Misc.inMyParty(leader)){		if(diabloleader && diabloleader.area>=109){			return dobaalleech();			//break;		}		delay(3000);	}	return scriptBroadcast("quit");	//quit();}function dobaalleech(){	var i, safeTP, portal;	this.checkMonsters = function (range, dodge) {		var monList = [],			monster = getUnit(1);		if (monster) {			do {				if (Attack.checkMonster(monster) && getDistance(me, monster) <= range) {					if (!dodge) {						return true;					}					monList.push(copyUnit(monster));				}			} while (monster.getNext());		}		if (!monList.length) {			return false;		}		monList.sort(Sort.units);		if (getDistance(me, monList[0]) < 25 && !checkCollision(me, monList[0], 0x4)) {			Attack.deploy(monList[0], 25, 5, 15);		}		return true;	};	this.getCorpse = function () {		if (me.mode === 17) {			me.revive();		}		var corpse,			rval = false;		corpse = getUnit(0, me.name, 17);		if (corpse) {			do {				if (getDistance(me, corpse) <= 15) {					Pather.moveToUnit(corpse);					corpse.interact();					delay(500);					rval = true;				}			} while (corpse.getNext());		}		return rval;	};	this.gotoSafePoint = function () {		if(me.y<5028)			Pather.moveTo(15118,5002);		else			Pather.moveTo(15118,5055);	};	this.checkThrone = function () {		var monster = getUnit(1);		if (monster) {			do {				if (Attack.checkMonster(monster) && monster.y < 5080) {					switch (monster.classid) {					case 23:					case 62:						return 1;					case 105:					case 381:						return 2;					case 557:						return 3;					case 558:						return 4;					case 571:						return 5;					default:						return false;					}				}			} while (monster.getNext());		}		return false;	};	stopbaal=false;	if(me.getStat(12)<60)		return false;	pri("baal leech start!");	Config.HPBuffer = 0;	Config.MPBuffer = 0;	Town.goToTown();	if(me.area!=109){		Pather.useWaypoint(109);	}	Town.doChores();	Town.move("portalspot");	baalmode=true;	if(!diablomode){		cgamename=calclastgamename(me.gamename);		savegameinfo(4,200);	}	var baalleader;	baalleader=checkhighestchar();	while (Misc.inMyParty(baalleader)) {			if(stopbaal)return true;			switch (me.area) {			case 109:				portal = Pather.getPortal(131, null);				if (portal) {					if (!safeTP) {						delay(3000);					}					//Pather.usePortal(108, leader);					Pather.usePortal(131, null);				}				break;			case 131:				if (!safeTP) {					if (this.checkMonsters(15, false)) {						pri("hot tp");						//Pather.usePortal(103, leader);						Town.goToTown();						this.getCorpse();						break;					} else {						this.gotoSafePoint();						safeTP = true;					}				}				if (this.checkMonsters(8, false)) {						pri("hot tp");						//Pather.usePortal(103, leader);						Pather.usePortal(109, null);						this.getCorpse();						safeTP = false;				}								delay(1000);				if(!getUnit(1, 543)) {					Pather.moveTo(15090, 5008);					Precast.doPrecast(true);					portal = getUnit(2, 563);					if (portal) {						Pather.usePortal(null, null, portal);					}				}				break;			case 132:				Pather.moveTo(15177,5953);				Attack.clear(8);				break;			default:				Town.goToTown();				if(me.area!=109){					Pather.useWaypoint(109);				}				break;			}	}	Config.HPBuffer = 20;	Config.MPBuffer = 10;	cgamename=me.gamename;	if(diablomode)		savegameinfo(3);	else		savegameinfo(4);	delay(2000);	return scriptBroadcast("quit");}function readgameinfo(){	if(FileTools.exists("tools/maplog/profile-"+me.profile+".txt"))		eval(FileTools.readText("tools/maplog/profile-"+me.profile+".txt"));}function givewp(){	var i, timeout, wpList;	if(drivername!=me.name){		say("go.");		delay(1500);	}	if(getroomcount(me.area)+1!=getpartycount()){		say("-come");		for (timeout = 0; timeout < 30; timeout += 1) {			if (getroomcount(me.area)+1==getpartycount()) {				break;			}			delay(1000);		}	}	var tome = me.findItem(518, 0, 3);	if (tome && tome.getStat(70) < 10) {		Town.doChores();	}			switch (me.act) {	case 1:		wpList = [3, 4, 5, 6, 27, 29, 32, 35];		break;	case 2:		wpList = [48, 42, 57, 43, 44, 52, 74, 46];		break;	case 3:		wpList = [76, 77, 78, 79, 80, 81, 83, 101];		break;	case 4:		wpList = [106, 107];		break;	case 5:		wpList = [111, 112, 113, 115, 123, 117, 118, 129];		break;	}	MainLoop:	for (i = 0; i < wpList.length; i += 1) {		try {			Pather.useWaypoint(wpList[i], true);			Pather.makePortal();			delay(1000);			say("1");			for (timeout = 0; timeout < 30; timeout += 1) {				if (getroomcount(wpList[i])+1==getpartycount()) {					break;				}				delay(1000);			}			say("3");			for (timeout = 0; timeout < 30; timeout += 1) {				if (getroomcount(wpList[i])==0) {					break;				}				delay(1000);			}			//delay(5000);		} catch (error) {		}	}}function calclastgamename(_name){	if(!_name)return "";	var _gamename;	var _length=_name.length;	var number1=parseInt(_name.substring(_length-1));	var number2=parseInt(_name.substring(_length-2,_length-1));	var number3=parseInt(_name.substring(_length-3,_length-2));		if(isNaN(number3))	{		if(isNaN(number2)){			if(isNaN(number1))				_gamename=_name;			else				_gamename=_name.substring(0,_length-1)+(number1-1);		}		else			_gamename=_name.substring(0,_length-2)+(number2*10+number1-1);	}	else		_gamename=_name.substring(0,_length-3)+(number3*100+number2*10+number1-1);	return _gamename;	}function droptype(){	if(!Town.openStash())return false;	var handitem = getUnit(100);	if(!handitem)return false;	var _itemtype;	var _count=1;	_itemtype=handitem.itemType;	handitem.drop();	var _item = me.findItems(-1,0);	if(_item){				for(var n = 0 ; n < _item.length ; n++){			if(_item[n].itemType == _itemtype){				_item[n].drop();				_count++;			}		}	}	pri("drop "+_count+" items,type = "+_itemtype,2);	return true;}function dropallgem(){	if(!Town.openStash())return false;	var _count=0;	var _item = me.getItems();	if(_item){				for(var n = 0 ; n < _item.length ; n++){			if(_item[n].itemType >= 96 && _item[n].itemType <= 102){				_item[n].drop();				_count++;			}		}	}	pri("drop "+_count+" items",2);	return true;}function dropclass(num){	if(!Town.openStash())return false;	var handitem = getUnit(100);	if(!handitem)return false;	var _itemclass;	var _count=1;	_itemclass=handitem.classid;	handitem.drop();	var _item=me.findItems(-1,0);	if(_item){		for(var n = 0 ; n < _item.length ; n++){			if(_item[n].classid == _itemclass){				_item[n].drop();				_count++;				if(_count>=num){					Pri("drop "+_count+" items,classid = "+_itemclass);					return true;				}			}		}	}	pri("drop "+_count+" items,classid = "+_itemclass,2);	return true;}function dropstash(){	if(!Town.openStash())return false;	var _count=0;	var handitem = getUnit(100);	if(handitem){		handitem.drop();		_count++;	}	var _item=me.findItems(-1,0);	if(_item){		for(var n = 0 ; n < _item.length ; n++)        	{			if(_item[n].location == 7){//7-箱子，3-背包				_item[n].drop();				_count++;			}		}	}	pri("drop "+_count+" items from stash",2);	return true;}function dropinv(){	var _count=0;	var handitem = getUnit(100);	if(handitem){		handitem.drop();		_count++;	}	var _item=me.findItems(-1,0);	if(_item){		for(var n = 0 ; n < _item.length ; n++){			if(_item[n].location == 3){				_item[n].drop();				_count++;			}		}	}	pri("drop "+_count+" items from inventory",2);	return true;}function dropall(){	if(!Town.openStash())return false;	var _count=0;	var handitem = getUnit(100);	if(handitem){		handitem.drop();		_count++;	}	var _item=me.findItems(-1,0);	var _needkeep;	var _keeplist=[543,549,518,519,603,604,605,587,588,589,590,591,592,593,594,595,596];	if(_item){		for(var n = 0 ; n < _item.length ; n++){						if(_item[n].location == 3){				_needkeep=false;				for(var i=0;i < _keeplist.length ; i++){					if(_keeplist[i] == _item[n].classid){						_needkeep=true;						break;					}				}				if(!_needkeep){					_item[n].drop();					_count++;				}			}		}	}	pri("drop "+_count+" items",2);	return true;}function stashItems() {	var _keeplist=[543,549,518,519,603,604,605,587,588,589,590,591,592,593,594,595,596];	var i,		items = me.getItems();	for (i = 0; i < items.length; i += 1) {		if (items[i].mode === 0 && items[i].location === 3 && _keeplist.indexOf(items[i].classid)==-1) {			Storage.Stash.MoveTo(items[i]);		}	}	return true;}function doautotake(){	var starttime=getTickCount();	D2Bot.init();	if(me.act!=1){		Town.move("waypoint");		Pather.useWaypoint(1);	}	Town.move("stash");	if(!Town.openStash() && !Town.openStash())		return false;	while(Misc.getPlayerCount()<2)		delay(2000);	eval(FileTools.readText("tools/autotake/autotakegameinfo.txt"));	droptakeitem();	me.cancel();	delay(4000);	if(checkitempick){		while(checkground())delay(1000);	}	MuleLogger.logChar(true,true,true);	say("waitting a little time to prevent realm down...");	while(getTickCount()-starttime<mintakegametime){		delay(2000);		//say("time left:"+(mintakegametime-getTickCount()+starttime));	}	if(dropend)		D2Bot.stop(me.profile,true);	else		D2Bot.restart(true);	return true;}function dealtakefile(filename){	var _list = new Array();	var nameloc = [0];//装备名行号	var accloc = [];//位置信息行号	var acclist =[];//含全部位置信息行内容	var accitemnum;	var i=0;	var j,k,l;	_list = FileTools.readText(filename).split("\n");		if(_list.length==0)return false;//增补换行符	for(j=0;j<_list.length;j++)	{		if(_list[j].substring(0,1)=="(" && _list[j].indexOf(" D2")!=-1 && _list[j].length > _list[j].indexOf(" D2")+5)		{			if(_list[j].substring(_list[j].indexOf(" D2")+4,_list[j].indexOf(" D2")+5)!=" ")				_list[j]=_list[j].substring(0,_list[j].indexOf(" D2")+4)+" "+_list[j].substring(_list[j].indexOf(" D2")+4);//增加空格，统一格式			_list.splice(j+1,0,_list[j].substring(_list[j].indexOf(" D2")+5));			_list[j]=_list[j].substring(0,_list[j].indexOf(" D2")+5);			j++;		}		if(_list[j].substring(0,1)=="(" && _list[j].indexOf(" D2")!=-1 && _list[j].length == _list[j].indexOf(" D2")+4)			_list[j]=_list[j]+" ";		}//删空行：	for(j=0;j<_list.length;j++)	{		if(_list[j]=="")		{			_list.splice(j,1);			j--;		}	}//删费行：	for(j=0;j<_list.length;j++)	{		if(_list[j].indexOf("life per level)")!=-1)		{			_list.splice(j,1);			j--;		}	}//删行尾空格	for(j=0;j<_list.length;j++)	{		if(_list[j].substring(0,1)!="(" && _list[j].indexOf(" D2")!=-1)			continue;		if(_list[j].substring(_list[j].length-1)==" ")		{			_list[j]=_list[j].substring(0,_list[j].length-1);			j--;		}	}//整理	for(j=0;j<_list.length;j++)	{		if(_list[j].substring(0,1)=="(" && _list[j].indexOf(" D2")!=-1)		{			nameloc.push(j+1);			accloc.push(j);			acclist.push(_list[j]);		}	}//删掉ilevel信息	for(j=0;j<nameloc.length-1;j++)	{		if(_list[nameloc[j]].indexOf("(")!=-1 && _list[nameloc[j]].indexOf(")")!=-1 && _list[nameloc[j]].substring(_list[nameloc[j]].length-1)==")" && !isNaN(_list[nameloc[j]].substring(_list[nameloc[j]].length-2,_list[nameloc[j]].length-1)))			_list[nameloc[j]]=_list[nameloc[j]].substring(0,_list[nameloc[j]].indexOf("(")-1);	}	//整理acclist，删掉重复acc	for(j=0;j<acclist.length;j++)	{		for(k=j+1;k<acclist.length;k++)			if(acclist[j]==acclist[k])			{				acclist.splice(k,1);				k--;			}	}//将物品归入acc	for(j=0;j<acclist.length;j++)	{		for(k=0;k<accloc.length;k++)		{			if(acclist[j].indexOf(_list[accloc[k]])!=-1)				acclist[j]=acclist[j]+"|"+(k+1);		}	}//重写文件	FileTools.writeText(filename,_list.join("\n"));	FileTools.writeText("tools/autotake/acclist.txt",acclist.join("\n"));	say("deal "+filename+" over,total "+accloc.length+" items,"+acclist.length+" chars.");	return accloc.length;}function writetake(filename,takenum){//写游戏名称等信息	var info="";	info+="takegamename='"+me.gamename+"';"+"\n";	info+="takegamepass='"+me.gamepassword+"';"+"\n";	info+="takeloc="+takenum+";"+"\n";	info+="takerealm='"+me.realm.toLowerCase()+"';"+"\n";	FileTools.writeText(filename,info);}function droptakeitem(){	var mytake=[];	var myinfo;	var myloc;	var info = new Array();;	var i=0;	var j;	var nextinfo="";	var nexttake;	info = FileTools.readText("tools/autotake/acclist.txt").split("\n");	for(j=0;j<info.length;j++)	{		if(info[j].indexOf(me.name)!=-1)		{			myinfo=info[j];			if(j<info.length-1)nextinfo=info[j+1];			myloc=j;			break;		}	}	mytake = myinfo.split("|");	nexttake=nextinfo.split("|");	mytake.splice(0,1);//删掉第一个元素	for(j=0;j<mytake.length;j++)	{		readtake("tools/autotake/takelist.txt",parseInt(mytake[j]));		delay(1000);		dropitem();		delay(1000);	}	say("drop "+ mytake.length+" items,pack "+(myloc+1)+" of "+info.length);	delay(1000);	if(myloc+1==info.length)	{		say("all drop over.");		dropend=true;		writetake("tools/autotake/autotakegameinfo.txt",-1);	}	else	{		writetake("tools/autotake/autotakegameinfo.txt",nexttake[1]);	}}function readtake(filename,num)//读取第num件装备信息：acc、loc、charname、装备name，drop数{	rinfo.splice(0,rinfo.length);//清空	var _list = new Array();	var nameloc = [0];	var accloc = [];	var acccount = 0;		_list = FileTools.readText(filename).split("\n");	if(_list.length==0)return false;	for(var j=0;j<_list.length;j++)	{		if(_list[j].substring(0,1)=="(" && _list[j].indexOf(" D2")!=-1)		{			nameloc.push(j+1);			accloc.push(j);			acccount++;		}	}	if(num>acccount)return false;	var accline=_list[accloc[num-1]];	//takeacc=accline.substring(1,accline.indexOf(")"));	//takecharname=accline.substring(accline.indexOf(")")+1,accline.indexOf(":"));	rname = _list[nameloc[num-1]];	if(rname.indexOf(" X ") !=-1)	{		dropnum = parseInt(rname.substring(rname.indexOf(" X ")+3));		rname = rname.substring(0,rname.indexOf(" X "));	}	else 		dropnum=1;	var k,i=0;	for(k=nameloc[num-1]+1;k<accloc[num-1];k++)	{		rinfo[i]=_list[k];		i++;	}	return true;	}function dropitem(num){	var _name;    if( arguments.length < 1 )	num=dropnum;	var dropx=0;	var isthisitem=false;	var _item=me.getItems();	if(_item)	{		for(var n = 0 ; n < _item.length ; n++)        	{			if(_item[n].fname.indexOf(rname)!=-1)			{				isthisitem=true;				for(var i=0;i<rinfo.length;i++)				{					if(shortdesc(_item[n]).indexOf(rinfo[i])==-1)					{						isthisitem=false;						break;					}				}				if(isthisitem)				{					_name=_item[n].fname.split("\n")[0];					if(_item[n].drop())					{						say("take this:"+_name);						dropx++;						delay(1200);					}					if(dropx==num)return true;					else return false;				}			}		}	}	return false;}function checkground(){	var _item = getUnit(4);	if(!_item)		return false;	do	{		if((_item.mode == 3 || _item.mode == 5) && getDistance(me, _item) <= 30)		{			return true;		}	} while(_item.getNext());	return false;}function shortdesc(unit){	var i, desc,	desc = unit.description;	desc = desc.split("\n");	for (i = 0; i < desc.length; i += 1) {		desc[i] = desc[i].replace("?", "", "g");		desc[i] = desc[i].replace(/(y|)c([0-9!"+<;.*])/g, "");	}	desc = desc.reverse().join("\n");	return desc;}function Wakka() {	var i, safeTP, portal, vizClear, seisClear, infClear, tick, diablo,		timeout = 1, // minutes		minDist = 50,		maxDist = 80,		leaderUnit = null,		leaderPartyUnit = null,		leader = "";	this.checkMonsters = function (range, dodge) {		var monList = [],			monster = getUnit(1);		if (monster) {			do {				if (monster.y < 5565 && Attack.checkMonster(monster) && getDistance(me, monster) <= range) {					if (!dodge) {						return true;					}					monList.push(copyUnit(monster));				}			} while (monster.getNext());		}		if (!monList.length) {			return false;		}		monList.sort(Sort.units);		if (getDistance(me, monList[0]) < 25 && !checkCollision(me, monList[0], 0x4)) {			Attack.deploy(monList[0], 25, 5, 15);		}		return true;	};	this.getLayout = function (seal, value) {		var sealPreset = getPresetUnit(108, 2, seal);		if (!seal) {			throw new Error("Seal preset not found. Can't continue.");		}		switch (seal) {		case 396:			if (sealPreset.roomy * 5 + sealPreset.y === value) {				return 1;			}			break;		case 394:		case 392:			if (sealPreset.roomx * 5 + sealPreset.x === value) {				return 1;			}			break;		}		return 2;	};	this.getCoords = function () {		this.vizCoords = this.getLayout(396, 5275) === 1 ? [7707, 5274] : [7708, 5298];		this.seisCoords = this.getLayout(394, 7773) === 1 ? [7812, 5223] : [7809, 5193];		this.infCoords = this.getLayout(392, 7893) === 1 ? [7868, 5294] : [7882, 5306];	};	this.checkBoss = function (name) {		var i, boss,			glow = getUnit(2, 131);		if (glow) {			for (i = 0; i < 10; i += 1) {				boss = getUnit(1, name);				if (boss && boss.mode === 12) {					return true;				}				delay(500);			}			return true;		}		return false;	};	this.getCorpse = function () {		if (me.mode === 17) {			me.revive();		}		var corpse,			rval = false;		corpse = getUnit(0, me.name, 17);		if (corpse) {			do {				if (getDistance(me, corpse) <= 15) {					Pather.moveToUnit(corpse);					corpse.interact();					delay(500);					rval = true;				}			} while (corpse.getNext());		}		return rval;	};	this.followPath = function (dest) {		var path = getPath(me.area, me.x, me.y, dest[0], dest[1], 0, 10);		if (!path) {			throw new Error("Failed go get path");		}		while (path.length > 0) {			if (me.mode === 17 || me.inTown) {				return false;			}			if (!leaderUnit || !copyUnit(leaderUnit).x) {				leaderUnit = getUnit(0, leader);			}			if (leaderUnit) {				if (this.checkMonsters(45, true) && getDistance(me, leaderUnit) <= maxDist) { // monsters nearby - don't move					path = getPath(me.area, me.x, me.y, dest[0], dest[1], 0, 15);					delay(200);					continue;				}				if (getDistance(me, leaderUnit) <= minDist) { // leader within minDist range - don't move					delay(200);					continue;				}			} else {				// leaderUnit out of getUnit range but leader is still within reasonable distance - check party unit's coords!				leaderPartyUnit = getParty(leader);				if (leaderPartyUnit) {					if (leaderPartyUnit.area !== me.area) { // leader went to town - don't move						delay(200);						continue;					}					// if there's monsters between the leecher and leader, wait until monsters are dead or leader is out of maxDist range					if (this.checkMonsters(45, true) && getDistance(me, leaderPartyUnit.x, leaderPartyUnit.y) <= maxDist) {						path = getPath(me.area, me.x, me.y, dest[0], dest[1], 0, 15);						delay(200);						continue;					}				}			}			if (Pather.moveTo(path[0].x, path[0].y)) {				path.shift();			}			this.getCorpse();		}		return true;	};	// start	Town.goToTown(4);	Town.move("portalspot");	if (Config.Leader) {		leader = Config.Leader;		for (i = 0; i < 30; i += 1) {			if (Misc.inMyParty(leader)) {				break;			}			delay(1000);		}		if (i === 30) {			throw new Error("Wakka: Leader not partied");		}	}	//autoLeaderDetect(108);	Town.doChores();	diablodie=false;	if (leader) {		while (Misc.inMyParty(leader)) {			if(diabloleader && diabloleader.area>=109)return true;			if(diablodie)return true;			switch (me.area) {			case 103:				//portal = Pather.getPortal(108, leader);				portal = Pather.getPortal(108, null);				if (portal) {					if (!safeTP) {						delay(4000);					}					//Pather.usePortal(108, leader);					Pather.usePortal(108, null);				}				break;			case 108:				if (!safeTP) {					if (this.checkMonsters(25, false)) {						pri("hot tp");						//Pather.usePortal(103, leader);						Pather.usePortal(103, null);						this.getCorpse();						break;					} else {						this.getCoords();						safeTP = true;					}				}				if (!vizClear) {					if (!this.followPath(this.vizCoords)) {						break;					}					if (tick && getTickCount() - tick >= 5000) {						vizClear = true;						tick = false;						break;					}					if (this.checkBoss(getLocaleString(2851))) {						if (!tick) {							tick = getTickCount();						}						pri("vizier dead");					}					break;				}				if (!seisClear) {					if (!this.followPath(this.seisCoords)) {						break;					}					if (tick && getTickCount() - tick >= 7000) {						seisClear = true;						tick = false;						break;					}					if (this.checkBoss(getLocaleString(2852))) {						if (!tick) {							tick = getTickCount();						}						pri("seis dead");					}					break;				}				if (!infClear) {					if (!this.followPath(this.infCoords)) {						break;					}					if (tick && getTickCount() - tick >= 2000) {						infClear = true;						tick = false;						break;					}					if (this.checkBoss(getLocaleString(2853))) {						if (!tick) {							tick = getTickCount();						}						pri("infector dead");					}					break;				}				if(!me.gametype && getpartycount()==8){					pri("back town,for 8pp exp bug.");					return Town.goToTown();				}				Pather.moveTo(7767, 5263);				diablo = getUnit(1, 243);				if (diablo && (diablo.mode === 0 || diablo.mode === 12)) {					return true;				}				break;			}			if (me.mode === 17) {				me.revive();			}			delay(200);		}	} else {		throw new Error("Empty game.");	}	return true;}